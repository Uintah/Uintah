<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
<meta name="generator" content="Adobe GoLive 4">
<title>Derived Fields</title>
<!-- Changed by: Ted Dustman, 21-Mar-2002 -->
</head>

<body bgcolor="#a9a9a9">
<table align="center" border="0" cellpadding="0" cellspacing="0" width="306" bgcolor="#cccccc">
<tr>
<td><img height="92" width="600" src="images/sub-banner.jpg" border="0"
    usemap="#sub-banner8662a0c4"><map name="sub-banner8662a0c4"><area
    coords="581,65,598,84" shape="rect" title nohref><area
    href="chapter_7.html" coords="557,64,575,83" shape="rect"
    title="Feedback"><area href="chapter_6.html" coords="532,64,550,82"
    shape="rect" title="Putting Simulation and Visualization
    Together"><area href="chapter_5.html" coords="508,64,527,83"
    shape="rect" title="Bioelectric Field Simulation"><area
    href="chapter_4.html" coords="483,64,502,83" shape="rect"
    title="Multi-Vis"><area href="chapter_3.html" coords="460,64,478,83"
    shape="rect" title="Derived Fields"><area href="chapter_2.html"
    coords="436,64,454,83" shape="rect" title="Looking at the Data"><area
    href="chapter_1.html" coords="412,64,430,81" shape="rect"
    title="Geometry Visualization"><area href="Intro.html"
    coords="354,64,406,84" shape="rect" title="Introduction"><area
    href="http://software.sci.utah.edu/doc/index.html"
    coords="205,63,343,83" shape="rect" title="Documentation"><area
    href="http://software.sci.utah.edu/" coords="103,63,195,82"
    shape="rect" title="Software"><area href="index.html"
    coords="1,65,92,81" shape="rect" title="Tutorial Home"></map></td> 
</tr>

<tr>
<td>
<center>
<table border="0" cellpadding="0" cellspacing="5" width="600">
	<tr>
	<td>
	<center>
	<br><p><A name="section-5"></A>
	<font size="4"
	face="Arial,Helvetica,Geneva,Swiss,SunSans-Regular"
	color="maroon">
	<b>Chapter 3: Derived Fields</b></font> </p>
        <p>&nbsp; </p>
        </center>
        <div align="left">
	<p><b><H4><A href="#section-1">3A: FieldBoundary</H4></b></A>
	<p><b><H4><A href="#section-2">3B: DirectInterpolate</H4></b></A>
	<p><b><H4><A href="#section-3">3C: Streamlines</H4></b></A>
	<p><b><H4><A href="#section-4">Network execution and data
	    dependence</H4></b></A> 

        <p><b>Chapter Overview</b><br>

        <p>In Chapters 1 and 2, we constructed SCIRun networks to
        visualize the geometry and data values in a Field.  In this
        Chapter, we will explore more visualization techniques,
        and look at &quot;filter&quot; modules that input a Field,
        and produce a new derived Field as output.  

	<p>Rather than building one net to introduce all of these new
	    modules, we 
        will construct several nets, each describing a single
        technique.  To keep things simple, we have subdivided this chapter
        into three sections, one for each method.
                
        <p><b><A name="section-1">3A: FieldBoundary</b><br></A>

	<p>We will first implement will be a boundary extraction. This module 
	takes any type of Field as input, and produces a new Field that
	    only contains the 
        boundary as output.  For example, given a tetrahedral volume
        Field, the module produces a triangulated surface Field of
        just the boundary faces as output.

	<p>To create a net using the FieldBoundary module
	    (SCIRun/Fields/FieldBoundary):
        <ol>
	  <li >Attach the output from a FieldReader 
	  (choose the utahtorso-lowres-voltage.tvd.fld file again)
	  to the FieldBoundary input port.
	  <li >Pass the contents of the first output port of the
	  FieldBoundary module into the first input port of a ShowField
	  module.   
	  <li>Set the ShowField module to display just edges (turn off the
	      nodes and the faces).
	  <li>Render the edges as a cylinder, with a scale of 1.0.
	  <li>Connect the output from the ShowField module into a Viewer
	      (don't forget to push the Autoview button to get the Viewer
	      to update the display).
	</ol>
	<p>Your net should look like <b>Figure 3.1</b>; the view in the
	Viewer window should look like <b>Figure 3.2</b>. 

      </div>
	<center>
	<p><img height="461" width="450" src="images/figures/3_1.gif"><br>
	<b>Figure 3.1</b></p>
	</center>
	<div align="left">
	<p><br>

      </div>
	<center>
	<p><img height="451" width="450" src="images/figures/3_2.gif"><br>
	<b>Figure 3.2</b></p>
	</center>
	<div align="left">
	<p><br>


        <p><b><A name="section-2">3B:DirectInterpolate</b><br></A>

	<p>Another useful technique for visualizing data is to interpolate
	data values 
	 from one Field to another Field. In this section, we will read in
	two datasets: 
	<ul> 
	  <li>The first contains the utahtorso volume data (mesh and
	      voltage values) we looked at in Chapter 1.
	  <li>The second contains the electrode positions that we saw in
	      <a href="chapter_2.html#electrodes">Chapter 2</a>.
	</ul>
	
	<p>We want to output a new Field containing the positions (as geometry)
	of the electrodes and corresponding voltage values
	interpolated from the utahtorso volume.

	<p>The utahtorso volume Field contains simulated voltage values
	through the entire volume.  For each electrode position of the
	electrodes, 
	we must look up the corresponding voltage value
	from the volume field. 
		
	<p>The module that implements this algorithm is called
	DirectInterpolate (SCIRun/Fields/DirectInterpolate).
	<p>To implement the net described above, we will need:
	<ul>
	<li>Two FieldReader modules 
	<li>One DirectInterpolate module 
	<li>One ShowField module
	<li>One GenStandardColorMaps module 
	<li>One RescaleColorMap module 
	<li>One Viewer module  
	</ul>
	<p>These should be hooked together as shown in <b>Figure 3.3</b>.
	<p><b>NOTE: </b>Don't forget to a) set the Node scale in the ShowField UI to be at
	least 2--4, and b) hit the Autoview button in the Viewer window.

      </div>
	<center>
	<p><img height="461" width="450" src="images/figures/3_3.gif"><br>
	<b>Figure 3.3</b></p>
	</center>
	<div align="left">
	<p><br>


	<p>The FieldReader on the left should read in the
	utahtorso-lowres-voltage.tvd.fld input file, and the
	FieldReader on the right should read in the
	utahtorso-lowres-electrodes.pcd.fld input file.  The resulting
	image in the Viewer Window should look like <b>Figure 3.4</b>.

      </div>
	<center>
	<p><img height="451" width="450" src="images/figures/3_4.gif"><br>
	<b>Figure 3.4</b></p>
	</center>
	<div align="left">
	<p><br>


        <p><b><A name="section-3">3C: StreamLines</b><br></A>

        <p>Streamline advection is the last visualization technique we will
	explore in this 
        chapter.  The StreamLine module takes in a vector Field and a Field
	of sample points. The  
	module then outputs a new Field consisting of a sequence of
	path-integral curves 
        generated from advecting (integrating) the sample positions
        through the (derivative) vector Field.

	<p>We will generate the input vector Field by using the
	Gradient module (SCIRun/Fields/Gradient) to compute the
	gradient of the utahtorso-lowres-voltage.tvd.fld (the gradient
	of the electric potential is equal to the negative of the electric
	field):   
	<ol>
	  <li value:"1.">Connect the output
	  from the Gradient module to the the first Field input port of
	  the StreamLines module.
	</ol>

	<p>To generate a sample distribution of StreamLine seed
	points, we will use the SampleField module.  SampleField
	generates samples from any type of input field and outputs the
	samples as a PointCloud field.  

	<ol>
	  <li VALUE="2."> Connect the output of the FieldReader to the
	  second (right most) input
	  of the SampleField module and then the field output of the
	  SampleField to the right input of the StreamLines module.
	</ol>

	<p>The SampleField module can generate the samples randomly or we
	can select this via a 3D widget.  For StreamLine visualization, we
	use a 3D "rake" widget to place our distribution of seed points.
	
	<p>To interactively position the rake of seed points within
	the volume:
	<ol>
	  <li value="3.">Connect the geometry output port (pink) of the
	  SampleField module to the Viewer module.  
	  <li>From the SampleField UI, select the "rake" option  and 
	      set the number of samples to 30.
	</ol>

	<p>At this point, we have streamlines coming out of the
        StreamLines module, and we would like to render them.  Before
        we do, we attach scalar data values to the
        StreamLine nodes.  To accomplish this, we use the
        DirectInterpolate module described above.  To create the
	visualization:
	<OL>
	  <LI VALUE="4."> With the FieldReader, select the input file
	  utahtorso-lowres-voltage.tvd.fld 
	  <LI> Connect the FieldReader to a ShowField module.
	  <LI> In this ShowField UI, display only Nodes, either as spheres
	      or points, with NodeScale set to about 1--2.
	  <LI> Connect a second ShowField module to the field output of the
	      DirectInterpolate module and the color map output of the
	      RescaleColorMap module.
	  <LI> For this ShowField, use the UI to display only edges, either
	      as cylinders or lines, with a Cylinder Scale of about 2.
	</OL>

	<p>With everything attached, we should have a network like that in
	<b>Figure 3.5</b>. 

      </div>
	<center>
	<p><img height="461" width="450" src="images/figures/3_5.gif"><br>
	<b>Figure 3.5</b></p>
	</center>
	<div align="left">
	<p><br>


	<p>The StreamLines module works by integrating the seed points
	through the vector Field.  We use a fifth order
	integration method: Runge-Kutta-Fehlberg algorithm.  To run
	this algorithm, we must set three parameters: Error Tolerance,
	Step Size, and a Maximum Number of Steps.  Set these three
	parameters to 0.01, 0.1, and 200, respectively,
	in the StreamLines UI (as shown in <b>Figure 3.6</b>).

	</div>
	<center>
	<p><img height="150" width="266" src="images/figures/3_6.gif"><br>
	<b>Figure 3.6</b></p>
	</center>
	<div align="left">
	<p><br>

	<p><b><A name="section-9">Controlling Widgets</b><br></A>

	While the network executes--it will take some time--we
	can explain more about widgets and executing a network.
	
	<p>The rake is one of a family of widgets--graphical elements
	in the Viewer that allow the user 
	to control interactively some features of the display.  The SCIRun
	widgets have a similar look and feel, but manipulate different
	aspects of the display,as detailed in the <a
	 HREF="../Guide/usersguide/srug5.html#sec:view-widgets">User's Guide
	5.4, Control Widgets</a>. 
	
	
	<p>You can control widgets by:
	<ul>
	  <li> Shift-left-click and drag any neutral spot on the widget to move
	      it around the region of view and thus change where it acts.
	  <LI> Shift-left-click on a <b>sphere</b> in the widget and change the
	      position of just that widget.
	  <LI> Shift-left-click on a <b>cylinder</b> in the widget and change,
	      for example, the density of streamlines the widget emits.
	  <LI> SCIRun will redraw the image in the Viewer window whenever
	      you release the mouse button.
	</ul>
	
	<p><b><A name="section-4">Network execution and data
	dependence</b><br></A> 
	
	<p>There are several ways to execute a SCIRun
	network that has not yet "fired." 
	<ul>
	  <li>Click the right mouse button on the name of one of
	      the module icons and select the "Execute" option from the
	      dropdown menu that appears (<b>Figure 3.7</b>).   
	  <li>Press any of the "Execute" buttons that appear in many of the
	      module User Interfaces.
	</ul> 

	These actions will execute the selected module as well as any modules 
	that depend on that module.

	</div>
	<center>
	<p><img height="165" width="270" src="images/figures/3_7.gif"><br>
	<b>Figure 3.7</b></p>
	</center>
	<div align="left">
	<p><br>

	<p>Now, back to the action!

	<P> After executing the network, you should see an image like
	<b>Figure 3.8</b> in the Viewer window.  The rake widget appears
	as a gray stick in this scene.  You may not get quite the same
	image as in the figure, but you should see the rake and colored
	streamlines coming from it.

	</div>
	<center>
	<p><img height="451" width="450" src="images/figures/3_8.gif"><br>
	<b>Figure 3.8</b></p>
	</center>
	<div align="left">
	<p>
	<br>

	
	<b><H4>Summary</b></H4>
	We have just constructed three nets, each describing a single
	method of  
	visualizing the utahtorso-lowres-voltage dataset.	

	<p>In the next chapter, we will merge those nets into a single,
	larger network  
	that performs concurrent visualizations.

	<br>
	<br><A HREF="#section-5">Back to Top</A>
        </div>
	</td>
	</tr>

	
</table>
</center>
</td>
</tr>
<tr>
<td><img height="35" width="600" src="images/sub-banner-bottom.jpg"
    border="0" usemap="#sub-banner-bottom8ac341b7"><map
    name="sub-banner-bottom8ac341b7"><area href="chapter_4.html"
    coords="563,1,590,21" shape="rect"><area href="chapter_2.html"
    coords="533,1,561,21" shape="rect"><area href="http://www.sci.utah.edu"
    coords="6,6,67,31" shape="rect"></map></td> 
</tr>
</table>
</body>
</html>
