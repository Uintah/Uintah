<html>
<head>
<!--
   For more information, please see: http://software.sci.utah.edu

   The MIT License

   Copyright (c) 2004 Scientific Computing and Imaging Institute,
   University of Utah.

   License for the specific language governing rights and limitations under
   Permission is hereby granted, free of charge, to any person obtaining a
   copy of this software and associated documentation files (the "Software"),
   to deal in the Software without restriction, including without limitation
   the rights to use, copy, modify, merge, publish, distribute, sublicense,
   and/or sell copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included
   in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
   THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
   DEALINGS IN THE SOFTWARE.
-->

<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
<meta name="generator" content="Adobe GoLive 4">
<title>Derived Fields</title>
</head>

<body bgcolor="#a9a9a9">

<A name="chapter-3">

<table align="center" border="0" cellpadding="0" cellspacing="0" width="306" bgcolor="#cccccc">
<tr>
<td><img height="92" width="600" src="images/sub-banner.jpg" border="0"
    usemap="#sub-banner8662a0c4"><map name="sub-banner8662a0c4"><area
    coords="581,65,598,84" shape="rect" title nohref><area
    href="chapter_7.html" coords="557,64,575,83" shape="rect"
    title="Feedback"><area href="chapter_6.html" coords="532,64,550,82"
    shape="rect" title="Putting Simulation and Visualization
    Together"><area href="chapter_5.html" coords="508,64,527,83"
    shape="rect" title="Bioelectric Field Simulation"><area
    href="chapter_4.html" coords="483,64,502,83" shape="rect"
    title="Multi-Vis"><area href="chapter_3.html" coords="460,64,478,83"
    shape="rect" title="Derived Fields"><area href="chapter_2.html"
    coords="436,64,454,83" shape="rect" title="Looking at the Data"><area
    href="chapter_1.html" coords="412,64,430,81" shape="rect"
    title="Geometry Visualization"><area href="Intro.html"
    coords="354,64,406,84" shape="rect" title="Introduction"><area
    href="../../index.html"
    coords="205,63,343,83" shape="rect" title="Documentation"><area
    href="http://software.sci.utah.edu/" coords="103,63,195,82"
    shape="rect" title="Software"><area href="index.html"
    coords="1,65,92,81" shape="rect" title="Tutorial Home"></map></td> 
</tr>

<tr>
<td>
<center>
<table border="0" cellpadding="0" cellspacing="5" width="600">
<tr>
<td>

<center>
<font face="Arial,Helvetica,Geneva,Swiss,SunSans-Regular" color="maroon">
<H1>Chapter 3: Derived Fields</H1></font>
</center>

<H2>Chapter Sections</H2>

<UL>
  <LI> 3-1: <A href="#section-1">FieldBoundary</A>
  <LI> 3-2: <A href="#section-2">DirectMapping</A>
  <LI> 3-3: <A href="#section-3">StreamLines</A>
  <LI> 3-4: <A href="#section-4">Controlling Widgets</A>
  <LI> 3-5: <A href="#section-5">Network Execution And Data Dependence</A>
  <LI> 3-6: <A href="#summary">Summary</A>
</UL>

<H2><A name="section-1">Chapter Overview</A></H2>

Chapters 1 and 2 demonstrated the construction of SCIRun networks to
visualize the geometry and data values in a Field. Chapter 3
explores additional visualization techniques, and examines
<i>filter</i> modules that receive a Field as input, then output a
newly derived Field.
<p>
Rather than building one net to introduce these modules, several nets
are constructed. Each net describes a single visualization
technique. This chapter is divided into three sections, one for each
method.
<p>
<H2><A name="section-1">FieldBoundary</A></H2>
<p>
First, create a net to show how to extract the boundary of a
Field. The FieldBoundary module extracts a boundary surface from a
volume. For example, given a TetVolMesh (volume), the module extracts the
boundary faces, and outputs a TriSurfMesh (surface).
<p>
Follow these steps to create a net using the FieldBoundary
(SCIRun-&gt;FieldsCreate-&gt;FieldBoundary) module:
<p>
<ol>
   <li> Add a FieldReader module to the canvas, and load the
   utahtorso-lowres-voltage.tvd.fld file.</p>
   <li> Now add a FieldBoundary module from SCIRun-&gt;FieldsCreate-&gt;FieldBoundary.</p>
   <li> Attach the output from a FieldReader into the FieldBoundary input port.</p>
   <li> Add a ShowField module and connect the FieldBoundary's first
        output to the ShowField's first input.</p>
   <li> Set the ShowField module to display edges only (turn off the
        nodes and the faces) and set the <I>Field Name</I> to Boundary.</p>
   <li> Also in the ShowField UI, render the edges as <I>Lines</I>,
        with a scale of 2.0. Enable Transparency.  Set the default
        color to dark gray (Give red, green, and blue a value of 0.3
        and an alpha of 0.8).</p>
   <li> Create a Viewer module, and connect the output from the
        ShowField module into the Viewer module.</p>
   <li> Press the Autoview button and rotate the image downward, to look like <b>Figure 3.2</b>.</p>
</ol>
<p>
The net should look similar to <b>Figure 3.1</b>. Save this net as
<i>3A.net</i>, it will be used in Chapter 4 of this tutorial, <b><A
href="chapter_4.html#section-1">Putting the nets
together.</b></A>.
<P>
<center>
<img src="images/figures/3_1.gif"><br>
<b>Figure 3.1, FieldBoundary Net (3A)</b>
<p>
<img width="500" height="530" src="images/figures/3_2.gif"><br>
<b>Figure 3.2, Field Boundary Of The Utah Torso Voltage Field</b>
</center>
<P>
<H2><A name="section-2">DirectMapping</A></H2>
<p>
Next, interpolate data values from one Field to another Field.
This section, demonstrates how to load two datasets.  The first
contains the utahtorso-lowres-voltage.tvd.fld  examined in <A
href="chapter_1.html#voltage">Chapter 1</a>, which refered to as
the <i>volume Field</i>.  The second contains the electrode positions
in utahtorso-lowres-electrodes.pcd.fld, from <a href="chapter_2.html#electrodes">Chapter 2</a>.
<p>
Once the datasets are loaded, create a new Field by
interpolating the electrode positions and voltage values.
Interpolation is the means used to calculate the value at a
certain point, by using the known values at surrounding points. For
each electrode, the corresponding voltage value must be found from the
volume Field.
<p>
The DirectMapping module implements this algorithm. Follow these
steps to create the DirectMapping net:
<ul>
  <li> Create a FieldReader module and load the
        utahtorso-lowres-voltage.tvd.fld file.
  <P>
  <li> Create a second FieldReader module and load the
        utahtorso-lowres-electrodes.pcd.fld file.
  <P>
  <li> Create a (SCIRun-&gt;FieldsData) DirectMapping module 
  <P>
  <li> Create a (SCIRun-&gt;Visualization) ShowField module
  <P>
  <li> Create a (SCIRun-&gt;Visualization) GenStandardColorMaps module 
  <P>
  <li> Create a (SCIRun-&gt;Visualization) RescaleColorMap module 
  <P>
  <li> Finally, create a (SCIRun-&gt;Render) Viewer module  
  <P>
  <LI> These modules should be hooked together as shown in <b>Figure
       3.3</b>.  NOTE: Set the Node Scale in the ShowField UI to be at
       least 5 (and select <I>Spheres</I>).  Also, hit the Autoview
       button in the ViewWindow and rotate the image in the ViewWindow
       downward to match the appearance found in <b>Figure 3.4</b>.
  <P>
  <LI> Note: the FieldReader on the left should read in the
       utahtorso-lowres-voltage.tvd.fld input file. The
       FieldReader on the right should read in the
       utahtorso-lowres-electrodes.pcd.fld input file.  Notice that
       the pipes from each of the FieldReaders (<B>Figure 3.3</B>)
       have been labeled with the type of Field data flowing through
       them.  The ability to annotate pipes is a new feature, and can
       be accessed by right clicking on the pipe and selecting
       <I>Notes</I>.  This annotation has no effect on the application,
       but is useful to the user for making networks more clear.
</UL>
<P>
<center>
<img width="450" height="622" src="images/figures/3_3.gif"><br>
<b>Figure 3.3: DirectMapping net</b>
</center>
<p>
<center>
<img width="500" height="529" src="images/figures/3_4.gif"><BR>
<b>Figure 3.4: DirectMapping Visualization</b>
</center>
<P>
Save this net as <i>3B.net</i>. It will be used in Chapter 4 of this
tutorial, <b><A href="chapter_4.html#section-2">Putting the nets
together</b></A>.
<P>
<H2><A name="section-3">StreamLines</A></H2>
<p>
Streamline advection is the last visualization technique explored in
this chapter. The StreamLines module visualizes vector Fields by
integrating curves through a gradient vector flow Field.
<p>
The input vector Field is generated by using the Gradient module
(SCIRun-&gt;FieldsData) to compute the gradient of the
utahtorso-lowres-voltage.tvd.fld.
<p>
Then, use the (SCIRun-&gt;FieldsCreate) SampleField module to
generate a sample distribution of StreamLine seed points.  SampleField
generates samples from any type of input Field, and outputs the samples
as a PointCloud Field.  The following modules are needed to run the
StreamLines net:
<P>
<ul>
	<li> One FieldReader module 
	<li> One (SCIRun-&gt;FieldsData) Gradient module 
	<li> One (SCIRun-&gt;FieldsCreate) SampleField module
	<li> Two ShowField modules 
	<li> One (SCIRun-&gt;FieldsData) DirectMapping module
	<li> One GenStandardColorMaps module
	<li> One RescaleColorMap module 
	<li> One Viewer module
        <li> One (SCIRun-&gt;Visualization) StreamLines module
</ul>
<p>
These modules should be hooked together as shown in <b>Figure 3.5</b>.
<P>
<center>
<img width="500" height="677" src="images/figures/3_5.gif"><br>
<b>Figure 3.5: StreamLines net</b>
</center>
<p>
Once the modules are connected, set the following GUI parameters:
<ul>
  <li> From the SampleField UI, select the rake option and set the
       maximum number of samples to 50.
  <p>
  <li> With the FieldReader, select the input file
       utahtorso-lowres-voltage.tvd.fld.
  <p>
  <li> In the ShowField UI (the upper right ShowField module), display
       only Nodes as spheres or points, with NodeScale set to
       approximately 1--2.
  <P>
  <li> For the second ShowField module (in the bottom-left corner of
       <b>Figure 3.5</b>), set the UI to display Edges only as
       cylinders with a Cylinder Scale of 2.
  <P>
  <LI> On the StreamLines GUI, choose <I>Cell Walk</I>, set <I>Error
       Tolerance</I> to 0.8, <I>Step Size</I> to 0.8, and <I>Maximum
       Steps</I> to 250.
  <P>
  <LI> On the RescaleColorMap GUI, select <I>Fixed Scale</I> and enter
  -50 for the <I>Min:</I> and 50 for the <I>max</I>.
</ul>
<P>
The SampleField module can generate samples randomly, or the user can
select samples using a 3D widget.  For Streamline visualization,
use a 3D <i>Rake</i> widget for distributing seed points. The user can
interactively position the rake of seed points within the volume.
<P>
The StreamLines module works by advecting the seed points through the
vector Field. The vector field is piecewise constant, so
the "Cell Walk" algorithm is used to trace out the streamlines.  
<P>
<center>
<img width="283" height="445" src="images/figures/3_6.gif"><br>
<b>Figure 3.6: StreamLines UI</b>
</center>
<p>
Save this net as <i>3C.net</i>. It will be used in Chapter 4 of this
tutorial, <b><A href="chapter_4.html#section-2">Putting the nets
together</b></A>.
<p>
<H2><A name="section-4">Controlling Widgets</A></H2>
<p>
The rake is one of many widgets used in SCIRun.  Widgets are graphical
elements in the Viewer that allow the user to interactively control
features of the display.  The SCIRun widgets have similar visual
characteristics, but manipulate different aspects of the display, as
detailed in the <a HREF="../../Guide/usersguide/srug6_5.html">User's
Guide 6.5, Control Widgets</a>.
<p>
Practice manipulating the widgets (and thus the SCIRun Viewer's display)
in the following manner:
<ul>
    <li> Hold down the shift key, then left-click the mouse on the
         widget and move the widget around the region of view to
         change its location and action.
    <p>
    <li> While holding down the shift key, left-click the mouse on a
	 <b>sphere</b> in the widget and change the position of that
	 widget.
    <p>
    <li> Hold the shift key and left-click the mouse on the end
         <b>knob</b> (green resize cylinders) in the widget and
         change, for example, the density of streamlines.
    <p>
    <li> SCIRun will redraw the image in the ViewWindow when the mouse button is released.
</ul>
<p>
<H2><A name="section-5">Network Execution and Data Dependence</A></H2>
<p>
There are several ways to execute a SCIRun network that has not fired.
<p>
In the StreamLines network:
<p>
<ul>
   <LI> On the Network Editor's File Menu, select <I>Execute All</I>
   <P>
   <li> On the module itself, right-click the mouse and select the
	Execute option from the dropdown menu (<b>Figure 3.7</b>).
   <p>
   <li> Each module's UI has its own Execute button.
</ul>
<p>
When a module is instructed to execute, all modules in its net
will also execute.  Note: if a module has already computed a result,
and its inputs have not changed,  it will use the previously
computed result.
<P>
<center>
<img src="images/figures/3_7.gif"><br>
<b>Figure 3.7: Module Control Menu</b>
</center>
<P>
After executing the StreamLines network, an image like 
<b>Figure 3.8</b> will appear in the ViewWindow.  The rake widget
will appear as a gray bar with spheres at the ends.  The user's image
may be slightly different than <b>Figure 3.8</b>, but the user should
see the rake and colored streamlines.  If the streamlines do not
appear, the user may need to check the object list and turn on the
Edges.
<P>
<center>
<img width="500" height="520" src="images/figures/3_8.gif"><br>
<b>Figure 3.8: Streamlines Visualization</b>
</center>
<div align="left">
<P>	
<H2><A name="summary">Summary</A></H2>
Three nets were constructed in chapter 3, each describing a single
method of visualizing the utahtorso-lowres-voltage dataset.
<p>
In chapter 4, the nets will be merged into a single, larger
network that performs concurrent visualizations.
<P>
<A HREF="#chapter-3">Return to Top</A>

</td>
</tr>
	
</table>
</center>
</td>
</tr>
<tr>
<td><img height="35" width="600" src="images/sub-banner-bottom.jpg"
    border="0" usemap="#sub-banner-bottom8ac341b7"><map
    name="sub-banner-bottom8ac341b7"><area href="chapter_4.html"
    coords="563,1,590,21" shape="rect"><area href="chapter_2.html"
    coords="533,1,561,21" shape="rect"><area href="http://www.sci.utah.edu"
    coords="6,6,67,31" shape="rect"></map></td> 
</tr>
</table>
</body>
</html>
