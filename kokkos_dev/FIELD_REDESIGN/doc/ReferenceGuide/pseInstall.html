<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
  <TITLE>PSE inst and build instructions - Unix/non-CVS version</TITLE>
  <!-- Changed by: TjD, 10-Aug-2000 -->

  <BODY>

    <CENTER>
      <H1>Installation and Build Instructions for the SCIRun PSE</H1>
      (Unix/non-CVS version)<BR><BR>
      by<BR>
      Chris Moulding
    </CENTER>

    <A NAME="TOC"></A><H2>Table of Contents</H2>

    <UL>
      <LI><A HREF="#Prerequisites">Prerequisites</A></LI>
      <LI><A HREF="#System Requirements">System Requirements</A></LI>
      <LI><A HREF="#Installing">Installing the PSE</A></LI>
      <LI><A HREF="#Building">Building the PSE</A></LI>
      <LI><A HREF="#RunningPSE">Running the PSE</A></LI>
      <LI><A HREF="#AdditionalDocs">Additional Documentation</A></LI>
      <LI><A HREF="#GettingHelp">Getting Help</A></LI>
      <LI><A HREF="#TclSurvival">Surviving the tcl stuff</A></LI>
    </UL>

    <A NAME="Prerequisites"></A><H2><A HREF="#TOC">Prerequisites</A></H2>


    <P>It is highly recommended that you have a fair amount of knowledge
      and experience with operating systems, file systems, and
      programming in general (and for SGI or Linux specifically) to
      build and install the PSE.  If you find that any of the
      instructions below are foreign to you, then you may want to have a
      system administrator help you out.</P>


    <A NAME="System Requirements"></A><H2><A HREF="#TOC">System Requirements</A></H2>

    <P>
      The following table describes system software requirements.  Unless otherwise noted
      <EM>exact</EM> versions of software are required.
    </P>

    <TABLE border>
      
      <TR><TH> Platform </TH><TH> Product </TH><TH> Version </TH></TR>

      <TR><TD> SGI </TD><TD> Irix </TD><TD> 6.5 or newer </TD></TR>
      
      <TR><TD> SGI </TD><TD> <A HREF="http://www.sgi.com/developers/devtools/languages/mipspro.html">MipsPro compiler</A> </TD><TD> 7.3.1 or newer </TD></TR>

      <TR><TD> Linux </TD><TD> Kernel </TD><TD> 2.2.14 or newer </TD></TR>

      <TR><TD> Linux </TD><TD> <A HREF="http://www.gnu.org/software/gcc/gcc.html">gcc</A> </TD><TD> <A HREF="ftp://gcc.gnu.org/pub/gcc/releases/gcc-2.95.2/gcc-2.95.2.tar.gz">2.95.2</A> or newer </TD></TR>
      
      <TR>  <TD> SGI/Linux </TD><TD> <A HREF="http://dev.scriptics.com/">Tcl</A> </TD><TD> <A HREF="ftp://ftp.scriptics.com/pub/tcl/tcl8_0/tcl8.0.4.tar.gz">8.0.4</A> </TD></TR>

      <TR> <TD> SGI/Linux </TD><TD> <A HREF="http://dev.scriptics.com/">Tk</A> </TD><TD><A HREF="ftp://ftp.scriptics.com/pub/tcl/tcl8_0/tk8.0.4.tar.gz">8.0.4</A>  </TD></TR>

      <TR> <TD> SGI/Linux </TD><TD> <A HREF="http://www.tcltk.com/itcl">iTcl/iTk</A> </TD><TD><A HREF="ftp://ftp.tcltk.com/tcltk/pub/itcl/itcl3.0.1.tar.gz">3.0.1</A>  </TD></TR>

      <TR><TD> SGI/Linux </TD><TD> <A HREF="http://www.tcltk.com/blt">BLT</A> </TD><TD><A HREF="http://www.tcltk.com/blt">2.4t or newer</A></TD></TR>

      <TR><TD>  SGI/Linux  </TD> <TD> <A HREF="http://www.gnu.org/software/make/make.html">GNU make</A> </TD> <TD><A HREF="ftp://ftp.gnu.org/pub/gnu/make/">3.76.1 or newer</A> </TD></TR>

      <TR><TD>  SGI/Linux    </TD><TD> <A HREF="http://xml.apache.org/xerces-c/index.html">Xerces XML parser</A> </TD><TD> <A HREF="http://xml.apache.org/dist/xerces-c/stable/">1.1.0 or newer</A> </TD></TR>



    </TABLE>

    <a NAME="archives"></a>
       <P>You can get this third party software directly from the vendors
       by clicking on the links in the table, or you can get them from
       our archives: 
      <OL>
        <LI>Binaries:
	  <UL>
	    <LI><a
	    href="http://www.cs.utah.edu/~moulding/ThirdParty.linux-i386.bin.tar.gz">Linux, i386 (~5.0MB)</a></LI>
	    <LI><a href="http://www.cs.utah.edu/~moulding/ThirdParty.irix-n32.bin.tar.gz">SGI, n32 (~5.5MB)</a></LI>
	    <LI><a href="http://www.cs.utah.edu/~moulding/ThirdParty.irix-64.bin.tar.gz">SGI, 64 (~5.5MB)</a></LI>
	  </UL>
	</LI>
	<LI><a
	href="http://www.cs.utah.edu/~moulding/ThirdParty.src.tar.gz">Sources
	(~27.0MB)</a></LI>
      </OL>
    </P>

    <P> Note that the compilers are not
        included in the binary distributions since their 
        installation is quite involved - please ask for a system
        administrator's assistance if you need to install/upgrade
        a compiler</P> 
	


    <A NAME="Installing"></A><H2><A HREF="#TOC">Installing the PSE</A></H2>


    <P>
      Unzip and untar the distribution file (PSE.tar.gz)
      into the directory where you would like the PSE to be
      installed, e.g. /usr/local/contrib/PSE.  There is no
      "make install" step in the build process, so where ever
      you untar to is where it will be installed.  We'll call
      this directory PSE_TOP from now on.
    </P>


    <A NAME="Building"></A><H2><A HREF="#TOC">Building the PSE</A></H2>


    <P>
      These are the steps for building the PSE:
    </P>

    <OL>
      <LI>
	<P>
	  Make sure that your system setup matches the 
	  <A HREF="#System Requirements">system requirements</A>, and
	  that your environment variables (i.e. PATH
	  and LD_LIBRARY_PATH) are set to use those
	  programs and libraries.
	</P>

	<P>
	  This part is the bane of many a users existence,
	  so we've added a <A HREF="#TclSurvival">section</A> to assist you.
	</P>
      </LI>

      <LI>
	<P>
	  Run configure.  From the PSE_TOP/src dir type:
	</P>

        <P>
	  <TT>configure --enable-package="PACKAGE"</TT>
	</P>

	<P>
	  Where PACKAGE is the name (or names) of the packages you want
	  to use.  For example "SCIRun", "Uintah", "BioPSE" or
	  "SCIRun Uintah BioPSE".
	</P>
      </LI>

      <LI>
	<P>
	  Finally, run GNU make.  From the PSE_TOP/src dir type:
	</P>

        <P>
	  <TT>make</TT>
	</P>

	<P>
	  It takes about 45 minutes to build the PSE (with only
	  the SCIRun package enabled) on a single 250MHz R10K
	  processor.  You can use the -j flag to reduce build
	  time.  For example:
	</P>

        <P>
	  <TT>make -j 32</TT>
	</P>

	<P>
	  will use 32 processors (if available) to build the PSE.  It
	  takes 5 minutes to build on 32 processors.
	</P>

	<P>
	  If the build failed, see <A HREF="#GettingHelp">"Getting Help"</A> below.
	</P>
      </LI>

    </OL>

    <A NAME="RunningPSE"></A><H2><A HREF="#TOC">Running the PSE</A></H2>


    <P>
      After a successful build, there will be  an executable in
      the PSE_TOP/src directory named:
    </P>

    <P>
      <TT>pse</TT>
    </P>

    <P>
      Running this will open the PSE network canvas window and start
      a console (called the PSE console) in the shell where pse was
      started from.
    </P>   

    <P>
      If the window does not appear, note any errors
      displayed in the PSE console and see the getting
      help section below.  Of course, it might just be
      hiding behind other windows on the desktop!
    </P>


    <A NAME="AdditionalDocs"></A><H2><A HREF="#TOC">Additional Documentation</A></H2>


    <P>
      Additional Documentation about the PSE can be obtained on
      the web at:
    </P>

    <P>
      <A HREF="http://www.cs.utah.edu/sci/scirun/"><TT>http://www.cs.utah.edu/sci/scirun/</TT></A>
    </P>


    <A NAME="GettingHelp"></A><H2><A HREF="#TOC">Getting Help</A></H2>


    <P>
      There is a mailing list available for asking questions about
      the PSE or to get help with resolving a problem.  To subscribe to
      the mailing list, send email to:
    </P>

    <P>
      <TT><A HREF="mailto:majordomo@cs.utah.edu">majordomo@cs.utah.edu</A></TT>
    </P>

    <P>
      with the following in the body of the message:
    </P>

    <P>
      <TT>subscribe scirun-develop</TT>
    </P>

    <P>
      To use the mailing list, simply send your question or problem
      as an email to the list:
    </P>

    <P>
      <A HREF="mailto:scirun-develop@cs.utah.edu"><TT>scirun-develop@cs.utah.edu</TT></A>
    </P>

    <P>
      To aid in problem resolution, include a verbatim copy of the error(s) 
      displayed (if any).  Also include a short description of what you
      we're doing (running a network, building the tree, etc.) and which
      version of the PSE you have (PSE 1.0 beta).
    </P>

    <A NAME="TclSurvival"></A><H2><A HREF="#TOC">Surviving the tcl stuff</A></H2>


    <P>
      The most difficult part of getting the PSE built has
      historically been the "tcl stuff".  This is due in part
      because the PSE depends on exact tcl versions and on a
      "correct" tcl installation, but also because of annoying
      bugs in the tcl distributions.
    </P>

    <P>
      Because of these problems we've included this section
      to, hopefully painlessly, guide you through the process.
    </P>   

    <P>
      Since the BLT package is not required to have an exact
      version (in fact, the only obtainable version is the
      latest listed on the blt website - which changes very
      frequently), we cannot guarentee that the blt distribution
      will work as described below.  However, we have a lot
      of experience with these packages and may be able to
      assist you if anything goes awry.
    </P>

    <P>
      The configure and installation steps are very important.
      Not configuring and installing as indicated will cause
      the PSE configure and build to fail.
    </P>   

    <P>
      Be sure to configure, build and install each package
      before the next, i.e. first tcl, then tk, then itcl/itk
      and finally blt.
    </P>

    <OL>
      <LI>
	<P>
	  Get the tcl distributions (tcl, tk, itcl/itk
	  and blt).  To assist in locating the distributions, 
	  we've included the URL's to them in the 
          <A HREF="#System Requirements">system requirements section</A>.
          You can also find them in our 
          <a HREF="#archives">archives</a>.

	</P>
      </LI>

      <LI>
	<P>
	  Unzip and untar all distributions into a
	  place where you would like to build them.  It doesn't 
	  necessarily have to be the installation location.
	  an example location is /usr/local/contrib/tcl/src:
	</P>

	<P>
	  <TT>
	    /usr/local/contrib/tcl/src/tcl8.0.4<BR>
            /usr/local/contrib/tcl/src/tk8.0.4<BR>
            /usr/local/contrib/tcl/src/itcl3.0.1<BR>
            /usr/local/contrib/tcl/src/blt2.4t
	  </TT>
	</P>
	
	<P>
	  We'll call this location TCL_SRC from now on.
	</P>

      </LI>

      <LI>
	<P>
	  Configure the distributions for a "correct" installation
	</P>

	<P>
	  Configure the tcl, tk, itcl/itk, and blt distributions as follows
	  (Note: INST_DIR is the location of the /lib and /bin dirs where
	  you want the final libraries and binaries to be installed, NOT
	  including /lib or /bin.  More details about INST_DIR are below):
	</P>     

	<P>
	  <TT>
	    cd TCL_SRC/tcl8.0.4/unix<BR>
            configure --enable-shared --prefix=INST_DIR
	  </TT>
	</P>     

	<P>
          <TT>
	    cd TCL_SRC/tk8.0.4/unix<BR>
            configure --enable-shared --prefix=INST_DIR --with-tcl=TCL_SRC/tcl8.0.4/unix
	  </TT>      
	</P>

	<P>
	  <TT>cd TCL_SRC/itcl3.0.1<BR>
          configure --enable-shared --prefix=INST_DIR \<BR>
	  --with-tcl=INST_DIR/lib --with-tk=INST_DIR/lib
	  </TT>
	</P>

	<P>
	  <TT>cd TCL_SRC/blt2.4t<BR>
          configure --enable-shared --prefix=INST_DIR \<BR>
          --with-tcl=INST_DIR/lib \<BR>
          --with-tk=INST_DIR/lib \<BR>
          --with-cc=cc
	  </TT>
	</P>

	<P>
	  Where INST_DIR is the location of the /lib and /bin dirs where
	  you want the final libraries and binaries to be installed, NOT
	  including /lib or /bin.  For example, the following:
	</P>   

	<P>
          <TT>--prefix=/usr/local/contrib</TT>
	</P>

	<P>
	  indicates that the /lib and /bin locations for the example tcl
	  install will be:
	</P>   

	<P>
          <TT>/usr/local/contrib/lib</TT> and
          <TT>/usr/local/contrib/bin</TT>
	</P>

	<P>
	  INST_DIR must be a full, absolute path.  If you build and install
	  the tcl distributions into your home directory, do not use ~ to
	  abbreviate the paths.
	</P>
      </LI>

      <LI>
	Edit some files

	<UL>
	  <LI>
	    <P>
	      SGI only!
	    </P>

	    <P>
	      Edit each of the following makefiles:
	    </P>

	    <P>
	      <TT>
		TCL_SRC/tcl8.0.4/unix/Makefile<BR>
		TCL_SRC/tk8.0.4/unix/Makefile<BR>
		TCL_SRC/itcl3.0.1/itcl/unix/Makefile<BR>
		TCL_SRC/itcl3.0.1/itk/unix/Makefile<BR>
		TCL_SRC/blt2.4t/src/shared/Makefile
	      </TT>
	    </P>

	    <P>
              In each makefile find this line:
	    </P>            

	    <P>
	      <TT>SHLIB_LD = <font color=red><b>ld -32</b></font> -shared -rdata_shared <font color=red><b>-rpath /usr/local/lib</b></font></TT>
	    </P>

            <P>
	      and change it to:
	    </P>

	    <P>
	      <TT>
		SHLIB_LD = <font color=red><b>ld -YOUR_ABI</b></font> -shared -rdata_shared <font color=red><b>-rpath INST_DIR</b></font>
	      </TT>
	    </P>
  
	    <P>
	      where YOUR_ABI is your system's default ABI (applications binary
              interface).  It is one of 32, n32 or 64.  Look in the file
              /etc/compiler.defaults.  In it there will be a line similar to:
	    </P>

            <P>
	      <TT>-DEFAULT:abi=n32:isa=mips4:proc=r10k</TT>
	    </P>
	    
	    <P>
              This example says the default ABI is n32 ("abi=n32").  If you cannot
              find this line or the file, and you don't know your system's ABI,
              assume that it's n32.
	    </P>

	  </LI>
	  <LI>
	    Linux only:

            <P>
	      Edit the following source file:
	    </P>

            <P>
	      <TT>TCL_SRC/tcl8.0.4/generic/tclPosixStr.c</TT>
	    </P>

            <P>
	      Search for the following two lines:
	    </P>

	    <P>
	      <CODE>
		case ENOTSUP: return "ENOTSUP";<BR>
		case ENOTSUP: return "operation not supported";
	      </CODE>
	    </P>

            <P>
	      and comment them out:
	    </P>

	    <P>
	      <CODE>
		/*case ENOTSUP: return "ENOTSUP";*/;<BR>
		/*case ENOTSUP: return "operation not supported";*/
	      </CODE>
	    </P>
	  </LI>
	</UL>     
      </LI>

      <LI>
	Build and install the distributions.
 
	<P>
	  These commands will build and install tcl, tk, itcl/itk, and blt:
	</P>

        <P>
	  <TT>
	    cd TCL_SRC/tcl8.0.4/unix<BR>
            make<BR>
            make -k install
	  </TT>
	</P>

        <P>
	  <TT>
            cd TCL_SRC/tk8.0.4/unix<BR>
            make<BR>
            make -k install
	  </TT>
	</P>

        <P>
	  <TT>
            cd TCL_SRC/itcl3.0.1<BR>
            make<BR>
            make -k install
	  </TT>
	</P>

        <P>
	  <TT>
            cd TCL_SRC/blt2.4t<BR>
            make<BR>
            make -k install
	  </TT>
	</P>
      </LI>

      <LI>
	Finally, set your paths.

	<UL>
	  <LI>
	    <P>
	      csh commands:
	    </P>

	    <P>
	      <CODE>
		setenv LD_LIBRARY_PATH INST_DIR/lib:$LD_LIBRARY_PATH<BR>
		setenv PATH INST_DIR/bin:$PATH
	      </CODE>
	    </P>
	  </LI>
	  <LI>
	    <P>
	      sh commands:
	    </P>
	    
	    <P>
	      <CODE>
		export LD_LIBRARY_PATH=INST_DIR/lib:$LD_LIBRARY_PATH<BR>
		export PATH=INST_DIR/bin:$PATH
	      </CODE>
	    </P>
	  </LI>
	</UL>
	<P>
	  <EM>SGI Note:</EM> In the previous commands,
	  LD_LIBRARY_PATH may actually be LD_LIBRARYN32_PATH
	  or LD_LIBRARY64_PATH if your system's default ABI
	  is n32 or 64.
	</P>

	<P>
	  You can verify that your tcl installation is correct by
	  typing the following:
	</P>

	<P>
	  <CODE>
            which tclsh8.0<BR>
            which wish8.0<BR>
            which itclsh3.0<BR>
            which itkwish3.0<BR>
            which bltwish24
	  </CODE>
	</P>

	<P>
	  if they all report that the executables being used are in
	</P>

	<P>
          <TT>INST_DIR/bin</TT>
	</P>

	<P>
	  Then your environment variables seem to be correct, and the
	  build most likely worked.
	</P>
      </LI>
    </OL>

  </BODY>
</HTML>