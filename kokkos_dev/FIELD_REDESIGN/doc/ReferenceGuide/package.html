<FONT COLOR=RED>
  <H1>WARNING: I think is this all out of date.  Dav.</H1>
</FONT>

<h1>How To Make a New Package In the PSE</h1>

<i>Somebody should edit this for readability, but enough should be here now
to help a little.</i><p>

Say we're making a new Package called <code>McQ</code> containing a single
module called <code>Euler</code>.<p>

<h3>Create a Directory to Hold Your Package</h3>

While in PSE/src:<p>

<ul><code>
  $ mkdir McQ<br>
  $ cd McQ<br>
</code></ul>

<h3>Create a GUI Directory Within Your Package</h3>

While in PSE/src/McQ:

<ul><code>
  $ mkdir GUI<br>
</code></ul>

<h3>Create a Directory for Your Module</h3>

While in PSE/src/McQ:

<ul><code>
  $ mkdir Euler<br>
</code></ul>

<h3>Create an <code>index.cc</code></h3>

While in PSE/src/McQ:

<ul><code>
  #include &lt<nop>PSECore/Dataflow/PackageDB.h&gt<br>
  #include &lt<nop>SCICore/Containers/String.h&gt<br>
  #include "Euler/Euler.h"<br>
  <br>
  using namespace SCICore::Containers;<br>
  using namespace PSECore::Dataflow;<br>
  using namespace McQ;<br>
  <br>
  extern "C" void initPackage(const clString& tcl) {
  <ul>
    packageDB.registerModule("McQ","SAMRAI","Euler",Euler::make,tcl+"/Euler.tcl");<br>
  </ul>
  }<br>
</code></ul>

<h3>Create a <code>Makefile.in</code></h3>

While in PSE/src/McQ:

<ul><code>
  SRCTOP   = @top_srcdir@<br>
  SRCDIR   = @srcdir@<br>
  OBJTOP   = ..<br>
<br>
  TCL_LIB_DIR   = @TCL_LIB_DIR@<br>
  TCL_LIB_FLAG  = @TCL_LIB_FLAG@<br>
  TK_LIB_DIR    = @TK_LIB_DIR@<br>
<br>
  TK_LIB_FLAG   = @TK_LIB_FLAG@<br>
  ITCL_LIB_DIR  = @ITCL_LIB_DIR@<br>
  ITCL_LIB_FLAG = @ITCL_LIB_FLAG@<br>
<br>
  SOLIB    = libMcQ.so<br>
<br>
  SOLIBRARIES = -L$(OBJTOP)/PSECore -lPSECore \<br>
  <ul><ul>
                -L$(OBJTOP)/SCICore -lSCICore \<br>
                -L$(ITCL_LIB_DIR) $(ITCL_LIB_FLAG) \<br>
                -L$(TK_LIB_DIR) $(TK_LIB_FLAG) \<br>
                -L$(TCL_LIB_DIR) $(TCL_LIB_FLAG) \<br>
                -lGLU -lGL -lXext -lX11 -lm<br>
  </ul></ul>
<br>
  include $(SRCTOP)/scripts/solib.mk<br>
<br>
  SUBDIRS  = Euler<br>
  SRCS     = index.cc<br>
<br>
  INCLUDES = -I$(SRCTOP) -I$(OBJTOP)<br>
<br>
  include $(SRCTOP)/scripts/objs.mk<br>
</code></ul>

<h3>Create a GUI File for your Module</h3>

Into file PSE/src/McQ/GUI/Euler.tcl:<p>

<ul><code>
itcl_class McQ_SAMRAI_Euler {<br>
  <ul>
  inherit Module<br>
<br>
  constructor {config} {<br>
  <ul>
    set name "SAMRAI Euler"<br>
  </ul>
  }<br>
<br>
  method ui {} {<br>
  <ul>
    set w .ui$this<br>
    if {[winfo exists $w]} {<br>
    <ul>
      raise $w<br>
      return;<br>
    </ul>
    }<br>
    toplevel $w<br>
    wm minsize $w 300 20<br>
  </ul>
  }<br>
</ul>
}<br>
</code></ul>

Note that the itcl_class name (here "McQ_SAMRAI_Euler") needs to match
the first three args to packageDB.registerModule concatenated with _'s
and with the spaces removed.<p>

The name in "set name" is what shows up on the module in the PSE GUI, and
can be whatever string you like.

<h3>Create A Header For Your Module</h3>

Into PSE/src/McQ/Euler/Euler.h:

<ul><code>
#ifndef __MCQ_EULER_H__<br>
#define __MCQ_EULER_H__<br>
<br>
#include &lt<nop>PSECore/Dataflow/Module.h&gt<br>
#include &lt<nop>SCICore/Continers/String.h&gt<br>
<br>
namespace McQ {<br>
<ul>
  using namespace SCICore::Containers;<br>
  using namespace PSECore::Dataflow;<br>
<br>
  class Euler: public Module {<br>
  <ul>
     public:<br>
     <ul>
       static Module* make(const clString& id);<br>
       Euler(const clString& id);<br>
       virtual void execute(void);<br>
     </ul>
<br>
    private:<br>
    <ul>
       // Instance variables, ports, etc. go here<br>
    </ul>
  </ul>
  };<br>
<br>
</ul>
}<br>
<br>
#endif // __MCQ_EULER_H__<br>
</code></ul>

<h3>Create An Implementation Of Your Module</h3>

Into PSE/src/McQ/Euler/Euler.cc:

<ul><code>
  #include &lt<nop>SCICore/Containers/String.h&gt<br>
  #include &lt<nop><PSECore/Dataflow/Module.h&gt<br>
  #include "Euler.h"<br>
<br>
  namespace McQ {<br>
  <ul>
<br>
    using namespace SCICore::Containers;<br>
    using namespace PSECore::Dataflow;<br>
<br>
    Module* Euler::make(const clString& id) {<br>
    <ul>
      return new Euler(id);<br>
    </ul>
    }<br>
<br>
    Euler::Euler(const clString& id): Module("Euler",id,Source) {<br>
    <ul>
      // whatever your constructor needs to do<br>
    </ul>
    }<br>
<br>
    void Euler::execute(void) {<br>
    <ul>
      // whatever your module does when it executes<br>
    </ul>
    }<br>
<br>
  </ul>
  }<br>
</code></ul>

<h3>Create A <code>Makefile.in</code> For Your Module</h3>

Into PSE/src/McQ/Euler/Makefile.in:

<ul><code>
SRCTOP   = @top_srcdir@<br>
SRCDIR   = @srcdir@<br>
OBJTOP   = ../..<br>
<br>
SRCS     = Euler.cc<br>
<br>
INCLUDES = -I$(SRCTOP) -I$(OBJTOP)<br>
<br>
include $(SRCTOP)/scripts/objs.mk<br>
</code></ul>

<h3>Edit <code>configure.in</code> To Configure Your Package</h3>

<h4>Add an <code>enable</code> argument</h4>

Add something that looks like:

<ul><code>
AC_ARG_ENABLE(mcq,<br>
<ul>
        [  --enable-mcq                 Build John McQ's modules],<br>
        [mcq="$enableval"],<br>
        [mcq=${mcq='no'}])<br>
</ul>
</code></ul>
near the similar code for other modules.  Look for <i>AC_ARG_ENABLE(uintah</i>
to get to the right place in configure.in.

<h4>Add your module to the make-sure-one's-on test</h4>

Look for the line like:

<ul><code>
if test "$scirun" = "no" -a "$uintah" = "no" -a "$davew" = "no"; then
</code></ul>

And make it look like:
<ul><code>
if test "$scirun" = "no" -a "$uintah" = "no" -a "$davew" = "no" -a "$mcq" = "no" ; then
</code></ul>

and also add an <code>echo</code> to the list immediately afterward to
include your new module.

<h4>Add a block for your module to the PACKAGE_PATH and configure your Makefiles</h4>

Look for a pair of lines like:

<ul><code>
  if test "$uintah" = "yes"; then
  <ul>
  PACKAGE_DIRS=$PACKAGE_DIRS" Uintah"
  </ul>
</code></ul>

And add a similar block for your module around the same place in configure.in:

<ul><code>
if test "$mcq" = "yes"; then
  <ul>
  PACKAGE_DIRS=$PACKAGE_DIRS" McQ"<br>
  PACKAGE_PATH=$PACKAGE_PATH":\$(OBJTOP_ABS)/McQ/libMcQ.so\(\$(SRCTOP_ABS)/McQ/GUI\)"<br>
  package_output="$package_output \<br>
  <ul><ul>
              McQ/Makefile \<br>
              McQ/Euler/Makefile \<br>
              "<br>
  </ul></ul>
  </ul>
fi<br>
</code></ul>

<h4>Regenerate <code>configure</code> From <code>configure.in</code></h4>

In PSE/src:

<ul><code>
  $ autoconf
</code></ul>

<h3>Building Your Module</h3>

Run-run configure to turn your module on, then build it.  In PSE/src:

<ul><code>
  $ ./configure --enable-mcq<br>
  $ gmake
</code></ul>
