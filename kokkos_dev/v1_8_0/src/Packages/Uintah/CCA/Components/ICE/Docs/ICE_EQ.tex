\documentclass[fleqn]{article}
\usepackage{amsmath}
\usepackage{doublespace}
\usepackage{algorithmic}
\usepackage{color}
\usepackage[dvips]{graphicx}
\usepackage{vmargin}
%\setpapersize{USletter}
\setmarginsrb{1.0in}{1.0in}{1.0in}{1.0in}{0pt}{0mm}{0pt}{0mm}
\newcommand{\B}[1]   {\biggr{#1}}
%...................................................
\usepackage{pslatex}
\usepackage[ps2pdf]{}
%.....................................................
% This command is necessary so that the subscripts, some of which are
% in capital letters come out
%\DeclareMathSizes{10}{10}{6}{5}
%______________________________________________________________________
\begin{document}
\setlength{\abovedisplayskip}{0.1in}
\setlength{\mathindent}{0.0in}
\underline{ I C E  ~ E Q ~  F O R M  \hspace{ 0.5in}06/19/02}

\begin{enumerate}
%__________________________________
\item Compute the equilibration pressure 
$P_{eq}, c_m, \rho^o_m, \theta_m$ such that $\sum\theta_m = 1$, see attached for details.
%__________________________________
\item Compute the face-centered velocities 
\[
    \vec{U_m}^{*^{f}} 
    = \biggl<\frac{\rho_m \vec{U_m}}{\rho_m}\biggr>^{n^{f}}
    -\frac{\Delta{t}}{<\rho^o_m>^f} \nabla^{f}P_{eq}
    + \sum_n\biggl<\frac{\Delta{t}\theta_n K_{n,m}}{\rho_m}\biggr>^f(\vec{U_n}^{*^{f}} - \vec{U_m}^{*^{f}})
    + \Delta{t}\vec{g}
\]
\[    
   =\frac{(\rho \vec{U})_{m_R} + (\rho \vec{U})_{m_L}}{\rho_{m_R} + \rho_{m_L}}
    -\Delta{t}\frac{2.0 (v^o_L v^o_R)}{v^o_L + v^o_R} (\frac{P_{eq_R} - P_{eq_L}}{\Delta x})
    + \text{Exchange Contribution}
    + \Delta{t}\vec{g}
\]
The exchange contribution involves a pointwise implicit solve, see attached for details.
%__________________________________
\item Compute the mass exchange between materials

\item Compute $\Delta P$ (eq 1.5)  
\[
     \Delta P = \Delta t \frac{ \sum {\frac{\dot{m_m}}{V\rho^0_m}} -\sum\nabla \cdot \theta_m \vec{U_m}^{*^{f}}}
     {\sum \frac{\theta_m}{\rho^o_m c^2_m}} 
     =
     \frac{\sum {\frac{\dot{m_m}}{V\rho^0_m}} -\text{Advection} (\theta_m\vec{U_m}^{*^{f}})}
     {\sum \frac{\theta_m}{\rho^o_m c^2_m}} 
    = \Delta{P_{\text{Mass Exchange}}} - \Delta{P_{\text{Dilatate}}}
\]
where $P^{n+1} = P_{eq} + \Delta{P}$.
%__________________________________
\item Compute the face centered pressure.
\[
    P^{*^{f}} = \frac{\frac{P}{\sum\rho_m} + \frac{P_{adj}}{\sum\rho_{m, adj}}}
                     {\frac{1}{\sum\rho_m} + \frac{1}{\sum\rho_{m, adj}}}
\]
%__________________________________
\item Accumulate sources\\  
 $\Delta(m\vec{U})_m = -\Delta{t} V \theta_m\nabla{ P^{*^f}} 
    + \Delta{t}V\sum_l\theta_m\theta_l K_{ml}(\vec{U_l}^{{n+1}^L} - \vec{U_m}^{{n+1}^L} )
    + \nabla{ \cdot \tau^{*^f}_m}
    + m_m \vec{g}\Delta{t}$
    
 $\Delta(me)_m =  (\frac{V}{\rho^o_m c^2_m}(\theta_m P \Delta P_{\text{Dilatate}})
    + \Delta{t}V\sum_l\theta_m\theta_l R_{ml}(T_l^{{n+1}^L} - T_m^{{n+1}^L} )$
%__________________________________
\item Compute Lagrangian quantities\\
    $\rho^L_m = \rho_m + (\frac{\Delta{m}}{V})_m$ \\
    $(m \vec{U})^L_m = (m\vec{U})_m + \Delta(m\vec{U})_m + (\vec{U}\Delta{m})_m$ \\
    $(m e)^L_m = (m e)_m + \Delta(m e)_m + \text{Released Heat}$\\
    \text{Note this includes the pointwise implicit solve for the momentum and energy exchange}
%__________________________________
\item Advect and Advance in time\\
$
    \rho^{n+1}_m     = \rho^L_m     - \Delta{t}\text{Advection}(\rho^L_m, \vec{U_m}^{*^{f}})$\\
$
    (m\vec{U})^{n+1}_m = (m\vec{U})^L_m - \Delta{t}\text{Advection}((\rho\vec{U})^L_m, \vec{U_m}^{*^{f}})$\\
$
    (me)^{n+1}_m       = (me)^L_m       - \Delta{t}\text{Advection}((\rho  e)^L_m, \vec{U_m}^{*^{f}})
$

\end{enumerate}
%______________________________________________________________________

\newpage
\underline{Calculation of the equilibration pressure}

\begin{algorithmic}
\STATE Find the microscopic density from the equation of state $\rho^O_m = eos(T_m,P) $
\STATE Compute the first guess for the volume fraction $\theta_m = \frac{\rho_m}{\rho^O_m}$
\WHILE{ $|1 - \sum{\theta_m}| <$ convergence criteria}
    \STATE  $P_{eos}[m] = eos(T_m,\rho^0_m) = (\gamma_m -1) * c_{v_m} * T_m * \rho^O_m$
    \STATE $\frac{dP}{d\rho^O}_m = (\gamma_m -1)*c_{v_m} * T_m$
        \FOR{$m=1$ to nMaterials}
        \STATE $Q[m] = P- P_{eos}[m]$
        \STATE $y[m] = \frac{dP}{d\rho^O}_m \frac{\rho_m}{\theta_m^2}$
    \ENDFOR
    \STATE $\Delta p = \frac{  \sum{\theta_m} - \theta_{closedpacked} - \sum{\frac{Q[m]}{y[m]}}  }{\sum{\frac{1}{y[m]}} } $
    \STATE $P_{eq}=P_{eq}+ \Delta p $
    \STATE $\rho^O_m = eos(P, T_m) = \frac{P}{(\gamma_m - 1)*c_{v_m}*T_m} $ 
    \FOR{$m=1$ to nMaterials}
        \STATE $ \theta_m =  \frac{\rho_m}{\rho^O_m}$
    \ENDFOR
\ENDWHILE 
\STATE Compute speed of sound $c_m$ at new pressure $P_{eq}$
\STATE verify that $\sum \theta_m = 1$
\STATE verify that $ \theta_m > 0$
  
\end{algorithmic}

%______________________________________________________________________
\newpage
\underline{Solving for the Lagrangian momentum with an implicit solve}

\begin{enumerate}
%__________________________________
\item Rearrange the starting momentum Equation in the x-direction \\
$    (mu)^{n+1^{L}}_m 
    = (m u)_m^{n}
    + \text{sources /Sinks}
    + \Delta{t} V \sum_n \theta_m \theta_n K_{m,n} (u_n^{n+1^{L}} - u_m^{n+1^{L}})
$\\
Divide through by the mass\\
$    u^{n+1^{L}}_m 
    = \frac{(m u)_m^{n} }{m^{n+1^{L}}_m}
    + \frac{\text{sources /Sinks} }{m^{n+1^{L}}_m}
    + \frac{\Delta{t} V \sum_n \theta_m \theta_n K_{m,n} (u_n^{n+1^{L}} - u_m^{n+1^{L}})}{m^{n+1^{L}}_m}
$\\ 
Now assume that $m^{n+1^{L}}_m = m^{n}_m$ and using $\theta_m = \frac{\rho_m}{\rho^o_m}$\\
$    u^{n+1^{L}}_m 
    = \underbrace{ u^{n}  }_a
    - \underbrace{\frac{\text{sources /Sinks} }{m^{n}_m}}_b
    + \underbrace{\Delta{t}\sum_n \frac{\theta_n K_{m,n}}{\rho^o_m} }_\beta  (u_n^{n+1^{L}} - u_m^{n+1^{L}})
$
\[
    u^{n+1^{L}}_m 
    = a
    + b
    + \beta_{mn}  (u_n^{n+1^{L}} - u_m^{n+1^{L}})
\]

\item Let \\
$u^{n+1^{L}}_m = \underbrace{\tilde u^{n^{L}}_m}_{\text{base vel FC}} 
+ \underbrace{\Delta{u^{L}_m}}_{\text{contribution due momentum exchange}}$
%__________________________________
\item  For two materials we have\\
$
    \tilde u^{n^{L}}_1 + \Delta{u^{L_1}} = a_1 + b_1 + 
    \beta_{12}\B[(\tilde u^{n^{L}}_2 + \Delta{u^{L_2}}) - (\tilde u^{n^{L}}_1 + \Delta{u^{L_1}}) \B]
$\\
$
    \tilde u^{n^{L}}_2 + \Delta{u^{L_2}} = a_2 + b_2 + 
    \beta_{21}\B[(\tilde u^{n^{L}}_1 + \Delta{u^{L_1}}) - (\tilde u^{n^{L}}_2 + \Delta{u^{L_2}}) \B]
$\\
\\
Note that $\tilde u^{n^{L}}_2 = a_1 + b_1$,and rearranging\\
$
\Delta{u^{L_1}}(1 + \beta_{12}) - \beta_{12}\Delta{u^{L_2}} = \beta_{12}(\tilde u^{n^{L}}_2 - \tilde u^{n^{L}}_1)
$\\
$
-\beta_{21}\Delta{u^{L_1}} - \Delta{u^{L_2}}(1 + \beta_{21}) = \beta_{21}(\tilde u^{n^{L}}_1 - \tilde u^{n^{L}}_2)
$
\[ \begin{vmatrix} (1 + \beta_{12})  &  -\beta_{12} \\
                  -\beta_{21}       &  (1 + \beta_{21})
    \end{vmatrix}
    \begin{vmatrix} \Delta{u^{L_1}} \\
                    \Delta{u^{L_2}}
    \end{vmatrix}
    =
    \begin{vmatrix} \beta_{12}(\tilde u^{n^{L}}_2 - \tilde u^{n^{L}}_1) \\
                    \beta_{21}(\tilde u^{n^{L}}_1 - \tilde u^{n^{L}}_2)
    \end{vmatrix}                
\]
%__________________________________
\item Solve for $\Delta{u^{L_1}}$ and add it to $\tilde u^{n^{L}}_m$ to get $u^{n+1^{L}}_m $
\end{enumerate}


%______________________________________________________________________
\newpage
\underline{Solving for the Face centered velocities with an implicit solve}

\begin{enumerate}
%__________________________________
\item Rearrange the starting momentum Equation in the x-direction \\
$    (mu)^{n+1^{*^{f}}}_m 
    = \B<(m u)_m\B>^{n^{f}}
    -\Delta{t} V \theta_m \nabla^{f}P_{eq}
    + \Delta{t} V \sum_n \B<\theta_m \theta_n K_{m,n}\B>^f (u_n^{n+1^{*^{f}}} - u_m^{n+1^{*^{f}}})
    + \Delta{t} m_m \vec{g}
$\\
 where $\theta = \frac{\rho_m}{\rho^o_m}=\nu^o_m$ and $m_m = \rho_m V$ so \\
$    (mu)^{n+1^{*^{f}}}_m 
    = \B<(m u)_m\B>^{n^{f}}
    -\Delta{t} \B<\frac{m_m}{\rho^o_m}\B>^f \nabla^{f}P_{eq}
    + \Delta{t}\sum_n \B<\frac{m_m\theta_n K_{m,n}}{\rho^o_m} \B>^f (u_n^{n+1^{*^{f}}} - u_m^{n+1^{*^{f}}})
    + \Delta{t} \B<m_m\B>^f \vec{g}
$\\ 
Now assume that $(m)^{n+1^{*^{f}}}_m = \B<m\B>^{n^{*^{f}}}_m$ and divide through.\\
$    (u)^{n+1^{*^{f}}}_m 
    = \underbrace{ \B<\frac{(\rho u)_m}{\rho_m}\B>^{n^{f}}  }_a
    - \underbrace{\Delta{t} \B<\frac{1}{\rho^o_m}\B>^f}_b \nabla^{f}P_{eq}
    + \underbrace{\Delta{t}\sum_n \B<\frac{\theta_n K_{m,n}}{\rho^o_m} \B>^f}_\beta  (u_n^{n+1^{*^{f}}} - u_m^{n+1^{*^{f}}})
    + \underbrace{\Delta{t} \vec{g}}_c
$
\[
    (u)^{n+1^{*^{f}}}_m 
    = a
    - b \nabla^{f}P_{eq}
    + \beta_{mn}  (u_n^{n+1^{*^{f}}} - u_m^{n+1^{*^{f}}})
    + c
\]
%__________________________________
\item Let \\
$u^{n+1^{*^{f}}}_m = \underbrace{\tilde u^{n^{*^{f}}}_m}_{\text{base vel FC}} 
+ \underbrace{\Delta{u^{*^{f}}}}_{\text{contribution due momentum exchange}}$
%__________________________________
\item  For two materials we have\\
$
    \tilde u^{n^{*^{f}}}_1 + \Delta{u^{*^{f}}_1} = a_1 - b_1\nabla^{f}P_{eq} + 
    \beta_{12}\B[(\tilde u^{n^{*^{f}}}_2 + \Delta{u^{*^{f}}_2}) - (\tilde u^{n^{*^{f}}}_1 + \Delta{u^{*^{f}}_1}) \B]
    + c
$\\
$
    \tilde u^{n^{*^{f}}}_2 + \Delta{u^{*^{f}}_2} = a_2 - b_2\nabla^{f}P_{eq} + 
    \beta_{21}\B[(\tilde u^{n^{*^{f}}}_1 + \Delta{u^{*^{f}}_1}) - (\tilde u^{n^{*^{f}}}_2 + \Delta{u^{*^{f}}_2}) \B]
    + c
$\\
\\
Note that $\tilde u^{n^{*^{f}}}_1 = a_1 - b_1\nabla^{f}P_{eq} + c$,and rearranging\\
$
\Delta{u^{*^{f}}_1}(1 + \beta_{12}) - \beta_{12}\Delta{u^{*^{f}}_2} = \beta_{12}(\tilde u^{n^{*^{f}}}_2 - \tilde u^{n^{*^{f}}}_1)
$\\
$
-\beta_{21}\Delta{u^{*^{f}}_1} - \Delta{u^{*^{f}}_2}(1 + \beta_{21}) = \beta_{21}(\tilde u^{n^{*^{f}}}_1 - \tilde u^{n^{*^{f}}}_2)
$
\[ \begin{vmatrix} (1 + \beta_{12})  &  -\beta_{12} \\
                  -\beta_{21}       &  (1 + \beta_{21})
    \end{vmatrix}
    \begin{vmatrix} \Delta{u^{*^{f}}_1} \\
                    \Delta{u^{*^{f}}_2}
    \end{vmatrix}
    =
    \begin{vmatrix}  \beta_{12}(\tilde u^{n^{*^{f}}}_2 - \tilde u^{n^{*^{f}}}_1) \\
                    \beta_{21}(\tilde u^{n^{*^{f}}}_1 - \tilde u^{n^{*^{f}}}_2)
    \end{vmatrix}                
\]
%__________________________________
\item Solve for $\Delta{u^{*^{f}}_1}$ and add it to $\tilde u^{n^{*^{f}}}_m$ to get $(u)^{n+1^{*^{f}}}_m $
\end{enumerate}

\end{document}
