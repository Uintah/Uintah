# $Id$

# System-dependent values determined by the configuration script.
AS_INSTALL_DIR = @prefix@
AS_ROOT_DIR    = @ROOT_DIR@
AR             = @AR@
C_FLAGS        = @C_FLAGS@ -I$(AS_ROOT_DIR) # added root dir -ejl
C_OPT_FLAGS    = @C_OPT_FLAGS@
CC             = @CC@
LD_LIBS        = @LD_LIBS@
PROFILE        = @PROFILE@
PROFILE_FLAGS  = @PROFILE_FLAGS@
RANLIB         = @RANLIB@

# Link and file names of the AppleSeeds library.
AS_LIBNAME = appleseeds
AS_LIBRARY = lib$(AS_LIBNAME).a

# Directory used for building the distribution file.
AS_DIST_NAME = AppleSeeds

HEADERS = appleseeds.h diagnosticseed.h envseed.h formatseed.h ipseed.h \
          netresourceseed.h propertyseed.h resourceseed.h semseed.h shmseed.h \
          vectorseed.h
OBJECTS = diagnosticseed.o envseed.o formatseed.o ipseed.o netresourceseed.o \
          propertyseed.o resourceseed.o semseed.o shmseed.o
SUBDIRS = Examples

# Added for vpath (multi-architecture) support.  -ejl
VPATH = @srcdir@


all: lib

lib: $(AS_LIBRARY)

clean:
	rm -f *.o $(AS_LIBRARY) config.cache config.log config.status

dist: Examples/Makefile
	mkdir $(AS_DIST_NAME)
	cp README *.c *.in $(HEADERS) configure $(AS_DIST_NAME)/
	mkdir $(AS_DIST_NAME)/Examples
	cd Examples && $(MAKE) dist DIST_DIR="$(AS_ROOT_DIR)/$(AS_DIST_NAME)/Examples"
	mkdir $(AS_DIST_NAME)/Doc
	cp Doc/* $(AS_DIST_NAME)/Doc || true
	tar cvf $(AS_DIST_NAME).tar $(AS_DIST_NAME)
	rm -fr $(AS_DIST_NAME)

Examples/Makefile:
	cd Examples && ./configure --with-appleseeds=$(AS_INSTALL_DIR)

examples: Examples/Makefile install_lib
	cd Examples && $(MAKE)

install: install_lib install_examples

install_examples: examples
	if [ ! -d $(AS_INSTALL_DIR)/bin ]; then mkdir $(AS_INSTALL_DIR)/bin; fi
	if [ ! -d $(AS_INSTALL_DIR)/examples ]; then \
          mkdir $(AS_INSTALL_DIR)/examples; \
        fi
	cd Examples && $(MAKE) dist DIST_DIR="$(AS_INSTALL_DIR)/examples" && \
	               $(MAKE) install INSTALL_DIR="$(AS_INSTALL_DIR)/bin"

install_lib: lib
	if [ ! -d $(AS_INSTALL_DIR) ]; then mkdir $(AS_INSTALL_DIR); fi
	if [ ! -d $(AS_INSTALL_DIR)/include ]; then \
          mkdir $(AS_INSTALL_DIR)/include; \
        fi
	cp $(HEADERS) Makeinclude $(AS_INSTALL_DIR)/include
	if [ ! -d $(AS_INSTALL_DIR)/lib ]; then mkdir $(AS_INSTALL_DIR)/lib; fi
	cp $(AS_LIBRARY) $(AS_INSTALL_DIR)/lib

opt:
	$(MAKE) C_FLAGS="$(C_FLAGS) $(C_OPT_FLAGS)"

uninstall:
	rm -fr $(AS_INSTALL_DIR)/bin $(AS_INSTALL_DIR)/examples \
               $(AS_INSTALL_DIR)/lib $(AS_INSTALL_DIR)/include

$(AS_LIBRARY): $(OBJECTS)
	$(AR) r $(AS_LIBRARY) $(OBJECTS)
	$(RANLIB) $(AS_LIBRARY)

.c.o:	$<
	$(CC) $(C_FLAGS) -c $< -o $@


