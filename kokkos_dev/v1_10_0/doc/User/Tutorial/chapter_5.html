<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
<meta name="generator" content="Adobe GoLive 4">
<title>Bioelectric Field Simulation</title>
</head>

<body bgcolor="#a9a9a9">
<table align="center" border="0" cellpadding="0" cellspacing="0" width="306" bgcolor="#cccccc">
<tr>
<td><img height="92" width="600" src="images/sub-banner.jpg" border="0"
    usemap="#sub-banner8662a0c4"><map name="sub-banner8662a0c4"><area
    coords="581,65,598,84" shape="rect" title nohref><area
    href="chapter_7.html" coords="557,64,575,83" shape="rect"
    title="Feedback"><area href="chapter_6.html" coords="532,64,550,82"
    shape="rect" title="Putting Simulation and Visualization
    Together"><area href="chapter_5.html" coords="508,64,527,83"
    shape="rect" title="Bioelectric Field Simulation"><area
    href="chapter_4.html" coords="483,64,502,83" shape="rect"
    title="Multi-Vis"><area href="chapter_3.html" coords="460,64,478,83"
    shape="rect" title="Derived Fields"><area href="chapter_2.html"
    coords="436,64,454,83" shape="rect" title="Looking at the Data"><area
    href="chapter_1.html" coords="412,64,430,81" shape="rect"
    title="Geometry Visualization"><area href="Intro.html"
    coords="354,64,406,84" shape="rect" title="Introduction"><area
    href="../../index.html"
    coords="205,63,343,83" shape="rect" title="Documentation"><area
    href="http://software.sci.utah.edu/" coords="103,63,195,82"
    shape="rect" title="Software"><area href="index.html"
    coords="1,65,92,81" shape="rect" title="Tutorial Home"></map></td> 
</tr>

<tr>
<td>
<center>
<table border="0" cellpadding="0" cellspacing="5" width="600">
	<tr>
	<td>
	<center>
	<br><A name="section-5"></A>
	<font size="4"
	face="Arial,Helvetica,Geneva,Swiss,SunSans-Regular"
	color="maroon">
	<b>Chapter 5: Bioelectric Field Simulation</b></font> </p>
        <p>&nbsp; </p>
        </center>
        <div align="left">
	
	<p><b><H4><A href="#section-1">Volume conductor problem</H4></b></A>
	<p><b><H4><A href="#section-2">Finite element simulation
	    network</H4></b></A> 
	<p><b><H4><A href="#section-3">FEM User Interface settings</H4></b></A>
	<p><b><H4><A href="#section-4">Running the simulation</H4></b></A>
	
        <p><b>Chapter Overview</b><br>

        <p>Chapters 1-4 work with dataflow programming. Networks were built to visualize existing 
        datasets. This chapter demonstrates the construction of a network that <em>computes</em>
        simulated voltages for a realistic volume conductor problem.

	<p>Thus far, modules from the
        SCIRun package have been used (packages are logically
	grouped sets of modules). <b>Figure 5.1</b> shows a SCIRun menu bar from a build that 
	features several additional packages. To learn more about packages, see <a   
	HREF="../Guide/usersguide/srug6.html#sec:packages">User's Guide 6.0,
	Packages.</a></p>

	<p>Modules within the SCIRun package serve as general purpose
        tools and are not targeted towards any specific application. This
        chapter uses 
        modules from the BioPSE package; a set of tools specifically written for the 
        modeling, simulation, and visualization of bioelectric field
        problems.

	

	</div>
	<center>
	<p><img height="54" width="442" src="images/figures/5_1.gif"><br>
	<b>Figure 5.1, showing the SCIRun package menu</b></p>
	</center>
	<div align="left">
	<p><br>

        <p><b><A name="section-1">Volume conductor problem</b></A>

	<p>Given a volume conductor model and an equivalent dipole
	source, the user will compute the potentials and electric
	field induced by the source through the domain.</p> 
<p>Analytic solutions exist for problems of specific geometric models (<i>e.g.</i>, cylinders or spheres). However, for most real-world problems, the solution can only be obtained
	through discretization.  For this application, the user will
	discretize the domain into tetrahedral finite elements, where
	each element contains a conductivity tensor that defines how
	electricity travels through its region of the domain.  Within
	each element, a piece-wise linear potential field is assumed
	(piece-wise constant electric field).

	<p>The above problem is governed mathematically by Poisson's
	equation:<br>

        <center>
	<img src="images/equation.gif" align="absbottom">
        </center>

	<p>where <img height="16" width="11" src="images/sigma.gif">
	is the local conductivity tensor, <img height="16" width="13"
	src="images/phi.gif"> is the voltage over the domain, and <img
	height="19" width="36" src="images/i.gif" align="texttop"> is
	a source term indicating where there are current sources
	within the domain. In plain language: the
	divergence (<img height="16" width="25"
	src="images/del_dot.gif" align="absbottom">) of the electric
	field (<img height="16" width="15" src="images/del.gif"
	align="absbottom"><img height="16" width="13"
	src="images/phi.gif" align="absbottom">) is zero where
	there is not a current source. 

	<p>Discretizing this onto the tetrahedral domain, 
	the divergence  
	of the electric field with the stiffness matrix <font
	size="4"><b>A</b></font> is approximated. <img height="16" width="13"
	src="images/phi.gif"> is a vector composed of voltages at the
	nodes. And <font size="4"><b>b</b></font> is a source vector
	indicating the flux through the nodes -- it is only non-zero
	for nodes that are corners of elements containing a current
	source. Given a stiffness matrix, <font
	size="4"><b>A</b></font>, and a source vector, <font
	size="4"><b>b</b></font>, the linear system can be solved:<br>

        <center>
	<p><img height="15" width="14" src="images/A.gif"><img
	height="16" width="13" src="images/phi.gif"><img height="16"
	width="20" src="images/equals.gif"><img height="16" width="10"
	src="images/b.gif">,
        </center>

	<p>to determine the potentials,<img height="16" width="13"
	src="images/phi.gif">, through the field. Taking the gradient,
	<img height="16" width="15" src="images/del.gif"><img
	height="16" width="13" src="images/phi.gif">, obtains the
	electric field through the domain.<br>

        <p><b><A name="section-2">Finite element simulation network</b><br></A>

	<p>To compute the electric and potential fields given a finite
	element volume conductor mesh and a dipolar current source, 
	follow these steps:</p>
	<p><ol><li value="1.">Load the finite element mesh (tet elements, with a conductivity tensors for each cell).</p>
	<p><li value="2.">Load dipole sources.</p>
	<p><li>Construct the finite element stiffness matrix based on
	the conductivity mesh.</p>
	<p><li>Construct the right side source vector based on
	the location and orientation of any dipole sources.</p>
	<p><li>Solve the linear system <img height="15" width="14"
	src="images/A.gif"><img height="16" width="13"
	src="images/phi.gif"><img height="16" width="20"
	src="images/equals.gif"><img height="16" width="10"
	src="images/b.gif">, to determine the potentials at the nodes.</p>
	</ol>
	<p>Each of the above steps corresponds to a SCIRun module.</p>
	  <p><ul><li>For steps 1 and 2, use 2 SCIRun/DataIO/FieldReader
	      modules.</p>  
	  <p><li>For step 3, use a BioPSE/Forward/SetupFEMatrix module.</p>  
	  <p><li>For step 4, use a BioPSE/Forward/ApplyFEMCurrentSource
	      module.</p>   
	  <p><li>And for step 5, use a SCIRun/Math/SolveMatrix module.</p>
	</ul>

	<p>All modules should be connected as shown in <b>Figure
	5.2</b>.</p>
<p><b>NOTE: Do not execute the net until all UI settings have been specified for each module, as described in the sections below, or the solution will not converge.</b></p>

      </div>
	<center>
	<p><img height="358" width="299" src="images/figures/5_2.gif"><br>
	<b> Figure 5.2, Biolelctric field simulation network</b></p>
	</center>
	<div align="left">
	<p><br>


        <p><b><A name="section-3">FEM User Interface settings</b><br></A>

	<p>The SetupFEMatrix module constructs a finite element
	stiffness matrix from a tetrahedral volume mesh. The user can choose to incorporate the local conductivity tensors into the stiffness matrix, or to use a uniform conductivity as shown in <b>Figure 5.3</b>.  For this application, incorporate the local conductivity changes.

	</div>
	<center>
	<p><img height="72" width="231" src="images/figures/5_3.gif"><br>
	<b>Figure 5.3, SetupFEMatrix UI</b></p>
	</center>
	<div align="left">
	<p>The ApplyFEMCurrentSource module modifies the right hand
	      side vector to account for current sources within the model.
	  In the module's UI, users can choose whether the
	      current sources are due to a dipole or a source/sink
	      electrode pair. For the Source Model option, select the dipole setting.</p>

	</div>
	<center>
	<p><img height="88" width="265" src="images/figures/5_4.gif"><br>
	<b>Figure 5.4 showing ApplyFemCurrentSource module UI</b></p>
	</center>
	<div align="left">
	</p>

	<p>The SolveMatrix module solves a linear system using one of
	several methods as indicated in the UI.</p>   
	  <p><ol><li>Beneath the Methods tab, choose Conjugate Gradient & Precond (SCI) method, and set the
	      Target Error to 0.0001.</p>
	  <p><li>Set the Maximum Iterations to 200.
	</ol></p>
	
	</div>
	<center>
	<p><img height="575" width="250" src="images/figures/5_5.gif"><br>
	<b>Figure 5.5, shows the SolveMatrix UI</b></p>
	</center>
	<div align="left">
	<p><br>

	<p>Finally, for this simulation:</p>
	  <p><ol><li value="1.">For the FieldReader on the left, load the
	      mesh Field utahtorso-lowres-mesh.tvt.fld.</p> 
	  <p><li>For the FieldReader on the right, load the
	      dipole Field utahtorso-lowres-dipole.pcv.fld.</p>   
	</ol>
	    
	<p>The mesh field contains the tetrahedral finite element mesh,
	which forms the geometry of the torso.  The mesh field also contains pointers to the electric conductivity values as assigned to each element.
	In Poisson's equation, these are the values of sigma. The dipole field
	contains a single dipole vector, positioned 
        within the torso volume that functions as the bioelectric source.

        <p><b><A name="section-4">Running the simulation</b><br></A>
		
	
	<p>Execute the network, and as the simulation progresses, the residual plot in
	the SolveMatrix UI converge. A finite element problem has just been solved. Save this net, it will be used in Chapter 6.</p>

	
	<p><H4><b>Summary</H4></b>
	Chapter five, demonstrated the use of modules from the bioelectric 
	problem solving environment (BioPSE) package. This chapter also illustrated the
	construction of a simulation network that computes simulated voltages for a 
	realistic volume conductor problem. 

	<p>Chapter 6 will reuse the finite element simulation
	network from this chapter,  
	as well as the visualization network from Chapter 4. 
	<br>
	<br><A href="#section-5">Return to Top</A>
	</div>
	</td>
	</tr>
</table>
</center>
</td>
</tr>
<tr>
<td><img height="35" width="600" src="images/sub-banner-bottom.jpg"
    border="0" usemap="#sub-banner-bottom8ac6e984"><map
    name="sub-banner-bottom8ac6e984"><area href="chapter_6.html"
    coords="566,2,589,20" shape="rect"><area href="chapter_4.html"
    coords="537,1,560,23" shape="rect"><area href="http://www.sci.utah.edu"
    coords="6,6,68,30" shape="rect" title="SCI Institute"></map></td> 
</tr>
</table>
</body>
</html>
