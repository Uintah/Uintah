#!/bin/sh

# usage setupTests <SCIRUN-ROOT> <SCIRUN-BUILD-ROOT> <dbg or opt> <maxProcs>
# will set up tests in cwd.

# outputs links to susdir, TestScripts, goldStandard, inputs
# creates do*tests for all tests in Packages/Uintah/Test

SCIRUNROOT=$1
BUILDROOT=$2
mode=$3
PARALLELISM=$4
OS=`uname -s`

if [ "$#" -lt 4 ]; then
    echo "usage: setupTests <SCIRUN-ROOT> <SCIRUN-BUILD-ROOT> <dbg or opt> <maxProcs>"
    exit 1
fi

# output links
rm -f susdir inputs goldStandard TestScripts
ln -s "$BUILDROOT/Packages/Uintah/StandAlone" susdir
ln -s "$SCIRUNROOT/src/Packages/Uintah/StandAlone/inputs" inputs
ln -s "/usr/sci/projects/Uintah/tester/$OS/TestData/$mode" goldStandard
ln -s "$SCIRUNROOT/src/Packages/Uintah/Test" TestScripts

dir=`pwd`
cd TestScripts
for test in *; do
    if [ -f "$test" -a -x "$test" ]; then
        cd $dir
	doTestScript="do${test}tests"
        echo "#!/bin/tcsh" > "$doTestScript"
        echo "setenv OS $OS" >> "$doTestScript"
        echo "python TestScripts/$test susdir inputs goldStandard $mode $PARALL\
ELISM "'$1' >> "$doTestScript"
        /bin/chmod a+x "$doTestScript"
	cd TestScripts
    fi
done
