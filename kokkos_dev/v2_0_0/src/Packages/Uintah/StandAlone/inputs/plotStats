#!/bin/csh
#__________________________________
#  This script pulls out data from sus 
#   output and plot it using gnuplot.
#  Usage:
#     plotStat <name of out file>
#__________________________________

if( $#argv == 0 ) then
  echo "You must input the name of the file that contains the simulation spew"
  exit(1)
endif
set out = $argv[1]
if ( !(-e $out) ) then
    echo "Couldn't find your file $out"
  exit(1)
endif 
unalias rm
#__________________________________
# extract the data
echo "Now extracting the data"

echo "?">&.meanTime
echo "?">>.meanTime  # mean time data isn't collect the first 4 timestps
echo "?">>.meanTime
echo "?">>.meanTime

grep elap $out | cut -d"=" -f4 | cut -d "," -f1 >& .elapsedTime
grep mean $out | cut -d" " -f 3 >> .meanTime
grep elap $out | cut -d"=" -f2 | cut -d"," -f1 >& .physicalTime
grep delT $out | cut -d"=" -f3 | cut -d"," -f1 >& .delT
grep delT $out | cut -d"=" -f5 >& .memUse
paste -d "  " .elapsedTime .meanTime .physicalTime .delT .memUse>& .data

rm -f .elapsedTime .meanTime .physicalTime .delT .memUse
#__________________________________
# generate the  plot script
cat > gp << fin
set multiplot
set size 1.0,0.50 # for two plots
set origin 0.0,0.5
set autoscale
set xdata time
set timefmt "%s"
set grid xtics ytics

set y2tics

plot '.data' using 1:3           t 'Physical Time' with lines,\
     '.data' using 1:2 axes x1y2 t 'meanTime/timestep' with lines
    #----------second plot-------------
set size 1.0,0.51       
set origin 0.0,0.0
set xlabel "ElapsedTime"

plot '.data' using 1:4 t 'Delt' with lines,\
     '.data' using 1:5 axes x1y2 t 'memory usage' with lines
set nomultiplot
pause -1 "Hit return to kill plot"
fin
#__________________________________
# plot it up
gnuplot gp

#__________________________________
# clean up
rm -f gp .data


exit(1)
