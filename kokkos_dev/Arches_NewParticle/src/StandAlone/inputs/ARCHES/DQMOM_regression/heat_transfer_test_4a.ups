<?xml version="1.0" encoding="iso-8859-1"?>
<!-- DOCTYPE Uintah_specification SYSTEM "input.dtd" -->
<!-- @version: -->

<Uintah_specification>
  
    <Meta>
        <title>DQMOM Heat Transfer Test 4a - Gas Temperature from Table (Tgas~900K), Tparticles~300K, With Radiation, No Convection (3 IC, 3 Env, Optimized Solver)</title>
    </Meta>

    <SimulationComponent type="arches" />

    <Time>
      <maxTime>10.0</maxTime>
      <max_Timesteps>10</max_Timesteps>
      <initTime>0.0</initTime>
      <delt_min>0.00001</delt_min>
      <delt_max>5</delt_max>
      <timestep_multiplier>0.8</timestep_multiplier>
    </Time>

    <DataArchiver>
        <filebase>uda_heatxfer_test_4a.uda</filebase>
        <outputTimestepInterval>1</outputTimestepInterval>
        <outputInitTimestep />

        <save label = "density" table_lookup = "true" />
        <save label = "mixture_fraction_2"/>
        <save label = "totalKineticEnergy"/>
        <save label = "newCCUVelocity"/>
        <save label = "newCCVVelocity"/>
        <save label = "newCCWVelocity"/>
        <save label = "newCCVelocity"/>
        <save label = "scalarSP"/>
        <save label = "densityCP"/>
        <save label = "viscosityCTS"/>
        <save label = "vorticity"/>
        <save label = "cellType"/>
        <save label = "tempIN"/>
        <save label = "heatLoss"/>

        <save label = "coal_gas_mix_frac" />
        <save label = "scalarSP" />

<!-- ===================================
        DQMOM Coal Variables
=====================================-->

        <save label = "w_qn0" />
        <save label = "w_qn0_src" />

        <save label = "w_qn1" />
        <save label = "w_qn1_src" />

        <save label = "w_qn2" />
        <save label = "w_qn2_src" />

        <save label = "length_qn0"/>
        <save label = "length_qn0_icv"/>
        <save label = "length_qn0_src"/>

        <save label = "length_qn1"/>
        <save label = "length_qn1_icv"/>
        <save label = "length_qn1_src"/>

        <save label = "length_qn2"/>
        <save label = "length_qn2_icv"/>
        <save label = "length_qn2_src"/>

        <save label = "RCmass_qn0"/>
        <save label = "RCmass_qn0_icv"/>
        <save label = "RCmass_qn0_src"/>

        <save label = "RCmass_qn1"/>
        <save label = "RCmass_qn1_icv"/>
        <save label = "RCmass_qn1_src"/>

        <save label = "RCmass_qn2"/>
        <save label = "RCmass_qn2_icv"/>
        <save label = "RCmass_qn2_src"/>

        <save label = "Tp_qn0"/>
        <save label = "Tp_qn0_icv"/>
        <save label = "Tp_qn0_src"/>

        <save label = "Tp_qn1"/>
        <save label = "Tp_qn1_icv"/>
        <save label = "Tp_qn1_src"/>

        <save label = "Tp_qn2"/>
        <save label = "Tp_qn2_icv"/>
        <save label = "Tp_qn2_src"/>

        <save label = "heat_qn0"/>
        <save label = "heat_qn1"/>
        <save label = "heat_qn2"/>

        <save label = "moment_000" />
        <save label = "moment_100" />
        <save label = "moment_010" />

        <checkpoint cycle="3" walltimeStart="3600" walltimeInterval="3600"/>
        <outputDoubleAsFloat/>
        <compression>gzip</compression>
    </DataArchiver>
    
    <Grid>
      <Level>
        <Box label = "1">
            <lower>[0,0,0]</lower>
            <upper>[1.0,1.0,1.0]</upper>
            <resolution>[8,8,8]</resolution>
            <extraCells>[0,0,0]</extraCells>
            <patches>[1,1,1]</patches>
        </Box>
        <periodic>[1,1,1]</periodic>
      </Level>
    </Grid>
    
    <PhysicalConstants>
        <gravity>[-9.8,0,0]</gravity>
        <reference_point>[0,0,0]</reference_point>
        <viscosity>0.000020</viscosity>
    </PhysicalConstants>
    
    <CFD>
        <!-- ARCHES specification -->
        <ARCHES>
            <!-- NOTE: Constant MMS works with tables (doesn't reset the tempIN label's value),
                       but Almgren MMS does NOT work with tables (it does reset the tempIN label's value) -->
            <MMS whichMMS="constantMMS" >
              <mmsErrorType>Linf</mmsErrorType>
              <constantMMS>
                <cu>0.0</cu>
                <cv>0.0</cv>
                <cw>0.0</cw>
                <cp>100</cp>
                <esphi0>0.0</esphi0>
                <useTable />
              </constantMMS>
            </MMS>
 
            <!-- TIME INTEGRATOR -->
            <TimeIntegrator>
                <ExplicitIntegrator order="second"/>
            </TimeIntegrator>
            
            <!-- Extra Transport Equations -->
            <TransportEqns>

                <Eqn label="mixture_fraction_2" type = "CCscalar">
                    <!-- diffusive scalar -->
                    <doDiff>true</doDiff>
                    <doConv>true</doConv>
                    <conv_scheme>super_bee</conv_scheme>
                    <initialization type = "constant">
                        <constant>0.0</constant>
                    </initialization>
                </Eqn>

                <Eqn label = "coal_gas_mix_frac" type = "CCscalar">
                    <doDiff>true</doDiff>
                    <doConv>true</doConv>
                    <addSources>true</addSources>
                    <conv_scheme>super_bee</conv_scheme>
                    <initialization type="constant">
                        <constant>0.0</constant>
                    </initialization>
                </Eqn>

            </TransportEqns>

            <Coal_Properties>
                <C>0.75</C>
                <H>0.05</H>
                <N>0.0</N>
                <O>0.2</O>
                <S>0.0</S>
                <initial_ash_mass>[1e-12,2e-12,3e-12]</initial_ash_mass>
            </Coal_Properties>  

            <DQMOM>
                
                <number_quad_nodes>3</number_quad_nodes>

                <LinearSolver>

                    <type>Optimize</type>
                    <tolerance>1e-5</tolerance>
                    <Optimization>
                      <Optimal_abscissas>[1,-1,1,-1,1,1,1,1,-1]</Optimal_abscissas>
                    </Optimization>

                </LinearSolver>
                
                <adiabGas_nonadiabPart>true</adiabGas_nonadiabPart>
                
                <Models>
                    
                    <model label="heat" type="CoalParticleHeatTransfer">
                        <ICVars>
                            <variable label="length" role="particle_length" />
                            <variable label="RCmass" role="raw_coal_mass" />
                            <variable label="Tp"     role="particle_temperature"/>
                        </ICVars>
                    </model>

                    <model label="my_density" type="ConstantDensityCoal">
                        <ICVars>
                            <variable label="length" role="particle_length" />
                            <variable label="RCmass" role="raw_coal_mass" />
                        </ICVars>
                    </model>

                </Models>

                <Weights>
                    <!-- w [=] #/m^3 -->
                    <doDiff>false</doDiff>
                    <doConv>false</doConv>
                    <initialization type="constant">
                        <constant>1.0e8</constant>
                    </initialization>
                    <scaling_const>1.0e8</scaling_const>
                </Weights>
                
                <Ic label="length">
                    <!-- l [=] m -->
                    <doDiff>false</doDiff>
                    <doConv>false</doConv>
                    <initialization type="env_constant">
                        <env_constant qn="0" value="30.0e-6"></env_constant>
                        <env_constant qn="1" value="70.0e-6"></env_constant>
                        <env_constant qn="2" value="100.0e-6"></env_constant>
                    </initialization>
                    <scaling_const>1.0e-6</scaling_const>
                </Ic>

                <Ic label="Tp">
                    <!-- l [=] m -->
                    <doDiff>false</doDiff>
                    <doConv>false</doConv>
                    <initialization type="env_constant">
                        <env_constant qn="0" value="300"></env_constant>
                        <env_constant qn="1" value="330"></env_constant>
                        <env_constant qn="2" value="350"></env_constant>
                    </initialization>
                    <scaling_const>1.0</scaling_const>
                </Ic>

                <Ic label="RCmass">
                    <!-- l [=] m -->
                    <doDiff>false</doDiff>
                    <doConv>false</doConv>
                    <initialization type="env_constant">
                        <env_constant qn="0" value="10.0e-9"></env_constant>
                        <env_constant qn="1" value="10.0e-8"></env_constant>
                        <env_constant qn="2" value="10.0e-7"></env_constant>
                    </initialization>
                    <scaling_const>1.0e-8</scaling_const>
                </Ic>

                <Moment><m>[0,0,0]</m></Moment>
                <Moment><m>[0,0,1]</m></Moment>
                <Moment><m>[0,1,0]</m></Moment>
                <Moment><m>[1,0,0]</m></Moment>
                <Moment><m>[0,1,1]</m></Moment>
                <Moment><m>[1,0,1]</m></Moment>
                <Moment><m>[1,1,0]</m></Moment>
                <Moment><m>[0,1,2]</m></Moment>
                <Moment><m>[0,2,0]</m></Moment>
                <Moment><m>[2,0,0]</m></Moment>
                <Moment><m>[0,0,3]</m></Moment>
                <Moment><m>[0,3,0]</m></Moment>

                <save_moments>true</save_moments>

            </DQMOM>

            <Turbulence model = "smagorinsky">
              <turbulentPrandtlNumber>0.4</turbulentPrandtlNumber>
              <cf>0.0</cf>
              <fac_mesh>1.0</fac_mesh>
              <filterl>0.000001</filterl>
              <var_const>0.1</var_const>
            </Turbulence>
            
            <Properties>
                <empirical_soot>false</empirical_soot>
                <use_mixing_model>false</use_mixing_model>
                <TabProps>
                    <inputfile>CoalModel.h5</inputfile>
                </TabProps>
            </Properties>
            
            <!--
            <BoundaryConditions>
            </BoundaryConditions>
            -->
            
            <ExplicitSolver>
                
                <timeIntegratorType>RK2SSP</timeIntegratorType>
                
                <initial_dt>0.05</initial_dt>
                <variable_dt>true</variable_dt>
                <scalarUnderflowCheck>true</scalarUnderflowCheck>
                
                <PressureSolver>
                    <linear_solver>petsc</linear_solver>
                    <parameters>
                        <res_tol>       1.0e-9</res_tol>
                        <solver>        cg    </solver>
                        <preconditioner>jacobi</preconditioner>
                        <max_iter>      75    </max_iter>
                    </parameters>
                </PressureSolver>
                
                <MomentumSolver>
                    <convection_scheme>central</convection_scheme>
                </MomentumSolver>
                
                <MixtureFractionSolver>
                    <convection_scheme>central-upwind</convection_scheme>
                    <initial_value>0.00</initial_value>
                </MixtureFractionSolver>
                
                <EnthalpySolver>
                    <convection_scheme>central-upwind</convection_scheme>
                    <radiationCalcFreq>5</radiationCalcFreq>
                    <radCalcForAllRKSteps>false</radCalcForAllRKSteps>
                    <DORadiationModel>
                     <opl>3.0</opl>
                     <LinearSolver type="petsc">
                     <res_tol>1.0e-10</res_tol>
                     <ksptype>gmres</ksptype>
                     <pctype>blockjacobi</pctype>
                     <max_iter>75</max_iter>
                     </LinearSolver>
                    </DORadiationModel> 
                </EnthalpySolver>
                
            </ExplicitSolver>
            
        </ARCHES>
    </CFD>
</Uintah_specification>
