<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE component SYSTEM "../../../../Dataflow/XML/component.dtd">

<!--
   For more information, please see: http://software.sci.utah.edu

   The MIT License

   Copyright (c) 2004 Scientific Computing and Imaging Institute,
   University of Utah.

   License for the specific language governing rights and limitations under
   Permission is hereby granted, free of charge, to any person obtaining a
   copy of this software and associated documentation files (the "Software"),
   to deal in the Software without restriction, including without limitation
   the rights to use, copy, modify, merge, publish, distribute, sublicense,
   and/or sell copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included
   in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
   THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
   DEALINGS IN THE SOFTWARE.
-->

<component name="Matlab" category="DataIO">
  <overview>
    <authors>
      <author>Oleg Portniaguine</author>
    </authors>
    <summary>
      Execute  Matlab commands and Matlab scripts in SCIRun.
    </summary>
    <description>
      <p>The Matlab module allows a SCIRun user to execute interactive
      Matlab commands and Matlab scripts and allows the exchange of
      data between SCIRun and Matlab.  Matlab and SCIRun can run on
      the same or different computers.  The matlab script mlabengine.m
      (part of the MatlabInterface package) provides communication
      between the Matlab module and the Matlab program using a socket
      protocol.</p>
      <p>The matlab module has five input and five output ports, which
      transport matrix data.  Input ports correspond to matlab
      variables named i1, i2, i3, i4, and i5.  Output ports correspond
      to matlab variables named o1, o2, o3, o4, o5.</p>
      <p>Matlab commands are entered into a text entry widget and are
      executed when the Matlab module's Execute button is pressed.</p>
      <p>See <xref target="gui"/> for details on the use of this
      module's control dialog.</p>
      <p>See <xref target="net1"/>, <xref target="net2"/>, <xref
      target="net3"/>, and <xref target="net4"/> for examples.</p>
      <p>Matlab graphics are not supported.  Matlab programs
      containing graphics commands will produce errors.</p>
      <p>A Matlab module  is created by selecting menu item
      Matlab from the DataIO sub-menu of the MatlabInterface menu.
      </p>
    </description>
  </overview>
  <io>
    <inputs lastportdynamic="yes">
      <port>
        <name>i1</name>
	<description>
	  <p>Port i1 corresponds to a matlab variable named i1.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>i2</name>
	<description>
	  <p>Port i2 corresponds to a matlab variable named i2.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>i3</name>
	<description>
	  <p>Port i3 corresponds to a matlab variable named i3.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>i4</name>
	<description>
	  <p>Port i4 corresponds to a matlab variable named i4.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>i5</name>
	<description>
	  <p>Port i5 corresponds to a matlab variable named i5.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
    </inputs>
    <outputs>
      <port>
        <name>o1</name>
	<description>
	  <p>Port o1 corresponds to a matlab variable named o1.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>o2</name>
	<description>
	  <p>Port o2 corresponds to a matlab variable named o2.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>o3</name>
	<description>
	  <p>Port o3 corresponds to a matlab variable named o3.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>o4</name>
	<description>
	  <p>Port o4 corresponds to a matlab variable named o4.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
      <port>
        <name>o5</name>
	<description>
	  <p>Port o5 corresponds to a matlab variable named o5.</p>
	</description>
        <datatype>SCIRun::Matrix</datatype>
      </port>
    </outputs>
  </io>
  <gui>
    <description id="gui">
      <p><xref target="fig.gui"/> shows module Matlab's control
      dialog.  The dialog consists of a number of "widgets", described
      below.</p>
      <figure id="fig.gui">
	<img>../Modules/DataIO/doc/MatlabGUI.gif</img>
	<caption>Matlab Module's Control Dialog</caption>
      </figure>
    </description>
    <parameter>
      <widget>Text Entry</widget>
      <datatype>String</datatype>
      <label>host:port</label>
      <description>
	<p>Three items are entered in the "host:port" widget:</p>
	<desclist>
	  <desclistitem>
	    <desclistterm>host</desclistterm>
	    <desclistdef>
	      <p>Host is the IP address of the computer running the
	      Matlab program.</p>
	      <p>Two special values of host are recognized:
	      127.0.0.1 and localhost.  The value 127.0.0.1 tells the
	      Matlab module to start the Matlab program (via the
	      mlabengine.m script) automatically.  The value localhost
	      tells the Matlab module that it will communicate with a
	      Matlab program running on the local host but the user is
	      responsible for starting Matlab via mlabengine.m.</p>
	      <p>If SCIRun and Matlab are running on separate
	      computers then host is the IP address of the computer
	      running Matlab.  The user is responsible for starting
	      Matlab on the remote computer.</p>
	    </desclistdef>
	  </desclistitem>
	  <desclistitem>
	    <desclistterm>port</desclistterm>
	    <desclistdef>
	      <p>The port number follows the host number and is
	      separated from host by a colon.  The Matlab module
	      communicates with the matlab engine script through this
	      port.  Port should be greater than 5000.  Port should be
	      5517 if host is 127.0.0.1.</p>
	    </desclistdef>
	  </desclistitem>
	  <desclistitem>
	    <desclistterm>info level</desclistterm>
	    <desclistdef>
	      <p>The value of info level determines the amount of
	      diagnostic output written to the terminal.  Info level
	      is separated from port by a space character. A value of 0
	      produces no output, a value of 1 produces some output,
	      and a value greater than 1 produces more output. </p>
	    </desclistdef>
	  </desclistitem>
	</desclist>
      </description>
    </parameter>
    <parameter>
      <widget>Scrolled Text Entry</widget>
      <datatype>Text</datatype>
      <label>Matlab Commands</label>
      <description><p>The Matlab Commands widget contains one or more
      Matlab commands.  The commands will be executed when the Execute
      button is pressed.</p></description>
    </parameter>
    <parameter>
      <widget>Button</widget>
      <datatype>N/A</datatype>
      <label>Execute</label>
      <description>
	<p>When Execute is pressed, matlab commands will be executed
	by module Matlab.</p>
      </description>
    </parameter>
  </gui>
  <nets>
    <net id="net1">
      <title>Network 1</title>
      <p>The network shown in <xref target="fig.net1"/> generates a
      5X5 random matrix, sends the matrix to module <modref
      name="MatrixWriter" package="SCIRun"/>, which saves the matrix
      to a file.</p>
      <figure id="fig.net1">
	<img>../Modules/DataIO/doc/MatlabNet1.jpg</img>
	<caption>Network that generates a 5X5 random matrix and writes
	the matrix to a file.</caption>
      </figure>
      <p><xref target="fig.net1"/> also shows the Matlab module's
      control dialog and a terminal window containing output generated
      by the module.  The following actions occur when the Execute
      button is pressed:</p>
      <orderedlist>
	<listitem>
	  <p>The matlab engine script is automatically launched.</p>
	</listitem>
	<listitem>
	  <p>The matlab engine starts listening for commands from the
	  Matlab module at port 5517 of address 127.0.0.1.</p>
	</listitem>
	<listitem>
	  <p>The Matlab module sends its command to the matlab engine.</p>
	</listitem>
	<listitem>
	  <p>The matlab engine receives and executes the command,
	  which generates a random matrix contained in variable o1.</p>
	</listitem>
	<listitem>
	  <p>The matrix is sent back to the Matlab module, which sends
	  the matrix downstream on the module's first output port.</p>
	</listitem>
	<listitem>
	  <p><modref name="MatrixWriter" package="SCIRun"/> receives
	  the matrix and writes it to disk.</p>
	</listitem>
      </orderedlist>
    </net>
    <net id="net2">
      <title>Network 2</title>
      <p>The network shown in <xref target="fig.net2"/> saves a SCIRun
      matrix as a matlab matrix.</p>
      <figure id="fig.net2">
	<img>../Modules/DataIO/doc/MatlabNet2.jpg</img>
	<caption>Network that saves a SCIRun matrix as a matlab
	matrix.  The Matlab module control dialog and a terminal
	window are also shown.</caption>
      </figure>
      <p>The following actions occur when the Execute button is
      pressed:</p>
      <orderedlist>
	<listitem>
	  <p>Module <modref name="MatrixReader" package="SCIRun"/>
	  reads a SCIRun matrix from a file.</p>
	</listitem>
	<listitem>
	  <p>The matlab engine starts listening for commands at port
	  5517 of address 127.0.0.1.</p>
	</listitem>
	<listitem>
	  <p>The Matlab module receives the matrix on port i1</p>
	</listitem>
	<listitem>
	  <p>The Matlab module sends the matrix to the matlab engine.
	  The matlab engine receives and stores the matrix in variable
	  i1.</p>
	</listitem>
	<listitem>
	  <p>The Matlab module sends the matlab command to the engine.</p>
	</listitem>
	<listitem>
	  <p>The matlab engine receives and executes the command,
	  saving the matrix to a file.</p>
	</listitem>
      </orderedlist>
    </net>
    <net id="net3">
      <title>Network 3</title>
      <p>The network shown in <xref target="fig.net3"/> saves a matlab
      matrix as a SCIRun matrix.</p>
      <figure id="fig.net3">
	<img>../Modules/DataIO/doc/MatlabNet3.jpg</img>
	<caption>Network that saves a matlab matrix as a SCIRun
	matrix.  The Matlab module control dialog and a terminal
	window are also shown.</caption>
      </figure>
      <p>The following actions occur when the Execute button is
      pressed:</p>
      <orderedlist>
	<listitem>
	  <p>The Matlab module starts the matlab engine, which listens
	  for commands at socket address 127.0.0:5517.</p>
	</listitem>
	<listitem>
	  <p>The Matlab module sends its matlab command to the matlab
	  engine.</p>
	</listitem>
	<listitem>
	  <p>The matlab engine receives and executes the command,
	  creating variable o1. </p>
	</listitem>
	<listitem>
	  <p>The matlab engine sends variable o1 to the Matlab module.</p>
	</listitem>
	<listitem>
	  <p>The matlab module receives the matrix and sends it to
	  module <modref name="MatrixWriter" package="SCIRun"/> on
	  port o1.</p>
	</listitem>
	<listitem>
	  <p>Module <modref name="MatrixWriter" package="SCIRun"/>
	  writes the matrix to a file.</p>
	</listitem>
      </orderedlist>
    </net>
    <net id="net4">
      <title>Network 4</title>
      <p>This example reuses the network of the <xref
      target="net1">first example</xref>.  This time, however, SCIRun
      and matlab (and the matlab engine script)  run on different
      machines.   SCIRun is run on scirun.sci.utah.edu and matlab
      (and the engine script) is run on matlab.sci.utah.edu.</p>
      <p>First, start matlab on matlab.sci.utah.edu.  Then issue the
      following command within matlab :</p>
      <pre>
  mlabengine(0, 'scirun.sci.utah.edu:5515')	
      </pre>
      <p>The above command starts the matlab engine, which listens
      for commands from scirun.sci.utah.edu on port 5515.</p>
      <p>Next, start SCIRun on scirun.sci.utah.edu and construct the
      network shown in <xref target="fig.net1"/>.</p>
      <p>Open the Matlab module's control dialog and enter the
      following for the host:port parameter:</p>
      <pre>
  matlab.sci.utah.edu:5515	
      </pre>
      <p>Press the Matlab module's Execute button.  This initiates the
      following sequence of events:</p>
      <orderedlist>
	<listitem>
	  <p>The Matlab module on scirun.sci.utah.edu sends the matlab
	  command to the matlab engine running on
	  matlab.sci.utah.edu.</p>
	</listitem>
	<listitem>
	  <p>The engine running on matlab.sci.utah.edu receives and
	  executes the command, which creates the matrix stored in
	  variable o1. The matrix is sent to scirun.sci.utah.edu</p>
	</listitem>
	<listitem>
	  <p>The Matlab module on scirun.sci.utah.edu receives the
	  matrix and sends it to module <modref name="MatrixWriter"
	  package="SCIRun"/> which saves the matrix to a file.</p>
	</listitem>
      </orderedlist>
    </net>
  </nets>
</component>
