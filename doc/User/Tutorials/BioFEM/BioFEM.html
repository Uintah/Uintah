<!--
   For more information, please see: http://software.sci.utah.edu

   The MIT License

   Copyright (c) 2004 Scientific Computing and Imaging Institute,
   University of Utah.

   License for the specific language governing rights and limitations under
   Permission is hereby granted, free of charge, to any person obtaining a
   copy of this software and associated documentation files (the "Software"),
   to deal in the Software without restriction, including without limitation
   the rights to use, copy, modify, merge, publish, distribute, sublicense,
   and/or sell copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included
   in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
   THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
   DEALINGS IN THE SOFTWARE.
-->

<!--

  This is supposed to be a valid xhtml file!  Please visit
  http://validator.w3.org/file-upload.html after editing this file.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="HTML Tidy for Mac OS X (vers 1st December 2002), see www.w3.org"
      name="generator" />
    <title>
      BioFEM Tutorial
    </title>

    <style type="text/css">
      body {
      background: #999999;
      margin-top: 0px;
      margin-bottom: 0px;
      }
      div.body {
      background: #CCCCCC;
      margin-left: 8%;
      padding-left: 2%;
      margin-right: 5%;
      padding-right: 2%;
      padding-bottom: 1em;
      padding-top: 1em;
      }
      pre {
      margin-left: 2%;
      }
      dt {
      font-weight: bold;
      }
      dd {
      margin-left: 2%;
      margin-bottom: 0.5em;
      }
      ins {
      color: black;
      background-color: #FF8800;
      text-decoration: none;
      }
      caption {
      margin-top: 1em;
      }
      table {
      border-collapse: collapse;
      margin-bottom: 1em;
      }
      th {
      text-align: left;
      }
      th, td {
      border: thin solid #999999;
      padding: 2px;
      }
    </style>

  </head>

  <body>
    <div class="body">
      <center>
	<img src="images/biofem-banner-main.jpg" alt="BioFEM Banner"
	  usemap="femt-banner-main" border="0"/> 
      </center>

      <map id="femt-banner-main" name="femt-banner-main">
	<area shape="rect" coords="405,170,497,194" href="http://www.sci.utah.edu" alt="SCI Web Site" />
	<area shape="rect" coords="510,172,590,193" href="http://software.sci.utah.edu"  alt="SCI Software Site" />
      </map>
      <h2>
	Contents
      </h2>
      <h3>
	Sections
      </h3>
      <ol>
	<li value="1">
	  <a href="#section_1">Introduction</a>
	</li>
	<li value="2">
	  <a href="#section_2">Getting Started</a> 
	  <ol>
	    <li value="1">
	      <a href="#section_2_1">Preparations</a>
	    </li>
	    <li value="2">
	      <a href="#section_2_2">Launching BioFEM</a>
	    </li>
	    <li value="3">
	      <a href="#section_2_3">User Interface Organization</a>
	    </li>
	  </ol>
	</li>
	<li value="3">
	  <a href="#section_3">Initial Processing and Visualization</a>
	</li>
	<li value="4">
	  <a href="#section_4">Visualization</a> 
	  <ol>
	    <li value="1">
	      <a href="#section_4_1">Viewer Options Tab</a>
	    </li>
	    <li value="2">
	      <a href="#section_4_2">Vis Options Tab</a>
	    </li>
	    <li value="3">
	      <a href="#section_4_3">IsoSurface</a>
	    </li>
	    <li value="4">
	      <a href="#section_4_4">Streamlines</a>
	    </li>
	    <li value="5">
	      <a href="#section_4_5">Electrodes</a>
	    </li>
	    <li value="6">
	      <a href="#section_4_6">Colormap</a>
	    </li>
	  </ol>
	</li>
      </ol>
      <h3>Appendices</h3>
      <ol type="A">
	<li><a href="#appendix_a">Data Formats and Preparation</a></li>
      </ol>
      <h3>Tables</h3>
      <ul>
	<li>
	  <a href="#table_1">Rendering Window's Mouse Controls</a>
	</li>
      </ul>
      <h3>Figures</h3>
      <ul>
	<li>
	  <a href="#figure_1">Figure 1: BioFEM Interface
	    Window</a>
	</li>
	<li>
	  <a href="#figure_2">Figure 2: BioFEM Interface
	    Window (Detached Panes)</a>
	</li>
	<li>
	  <a href="#figure_3">Figure 3: File Menu</a>
	</li>
	<li>
	  <a href="#figure_4">Figure 4: Help Menu</a>
	</li>
	<li>
	  <a href="#figure_5">Figure 5: Initial Visualization</a>
	</li>
	<li>
	  <a href="#figure_6">Figure 6: Viewer Options Tab </a>
	</li>
	<li>
	  <a href="#figure_7">Figure 7: Vis Options Tab </a>
	</li>
	<li>
	  <a href="#figure_8">Figure 8: Isosurface Visualization</a>
	</li>
	<li>
	  <a href="#figure_9">Figure 9: Streamlines Visualization</a>
	</li>
	<li>
	  <a href="#figure_10">Figure 10: Electrodes Visualization</a>
	</li>
	<li>
	  <a href="#figure_11">Figure 11: Visualization with
	    Blue-to-Red color-map</a>
	</li>
	<li>
	  <a href="#figure_a1">Figure A1: Network that creates a
	  complete SCIRun tensor volume field</a>
	</li>
	<li>
	  <a href="#figure_a2">Figure A2: Network that creates a
	  dipole field</a>
	</li>
      </ul>

      <a name="section_1" id="section_1"/>
      <h2>Section 1&ndash;Introduction</h2>
      <p>
	BioFEM is a SCIRun PowerApp that computes the electric field
	in a volume produced by a set of dipoles. BioFEM computes a
	solution to the bioelectric field forward problem.  BioFEM
	also computes voltage values at electrode positions, which can
	be compared with values recorded via ECG or EKG.
      </p>

      <p>
	BioFEM requires these inputs:
      </p>
      <ul>
	<li>
	  <p>A discretized volume with associated volume element
	  conductivities.</p>
	</li>
	<li>
	  <p>A dipole.</p>
	</li>
	<li>
	  <p>The positions of a set of measurement electrodes.</p>
	</li>
      </ul>

      <p>
	<a href="#appendix_a">Appendix A</a> gives instructions for
	preparing these data.  This tutorial, however, uses BioFEM to
	process and visualize the Utah Torso data set. No data set
	preparations are needed to run this tutorial.  The Utah Torso
	data set is part of the SCIRun sample data set collection, and
	can be <a
	href="http://software.sci.utah.edu/datasets/SCIRunData.1.24.1.tar.gz">downloaded</a>
	from SCI's web site.
      </p>

      <a name="section_2" id="section_2"/>
      <h2>Section 2&ndash;Getting Started</h2>
      <p>
	This section demonstrates how to start BioFEM. Subsequent
	sections demonstrate how to load, process, and visualize data.
      </p>
      
      <a name="section_2_1" id="section_2_1"/>
      <h3>2.1 Preparations</h3>

      <p>
	Before starting BioFEM, the environment variables SCIRUN_DATA
	and SCIRUN_DATASET must be set.
      </p>
      <p>
	SCIRUN_DATA points to the sample data sets directory.
	This tutorial assumes the SCIRun sample data directory is
	<tt>/usr/sci/data/SCIRunData/1.24.2</tt>. So, SCIRUN_DATA is
	set to (for a csh-like shell):
      </p>
      <pre>
  setenv SCIRUN_DATA /usr/sci/data/SCIRun/SCIRunData/1.24.2
      </pre>
      <p>
	SCIRUN_DATASET points to a specific data set directory
	within the data directory.
      </p>

      <p>
	The Utah Torso data set exists in high resolution and low
	resolution versions.  
      </p>	
	
      <p>
        To use the high resolution data set,
	SCIRUN_DATASET must be set to "utahtorso":
      </p>

      <pre>
  setenv SCIRUN_DATASET utahtorso
      </pre>

      <p>
	To use the low resolution dataset, SCIRUN_DATASET must be set
	to "utahtorso-lowres":
      </p>

      <pre>
  setenv SCIRUN_DATASET utahtorso-lowres
      </pre>

      <p>
	This tutorial uses the low resolution data set.
      </p>

      <a name="section_2_2" id="section_2_2"/>
      <h3>2.2 Launching BioFEM</h3>
      <p>
	Change the working directory (using the <tt>cd</tt> command)
	to the directory containing the BioFEM executable.  This
	directory will be <tt>/usr/local/SCIRun/bin/</tt> if SCIRun
	has been installed via RPM.  Then type <tt>./BioFEM</tt> to
	start BioFEM:
      </p>
      <pre>
  cd /usr/local/SCIRun/bin
  ./BioFEM
      </pre>

      <p>
	BioFEM takes a few moments to start up, then displays
	the window shown in <a href="#figure_1">Figure 1.</a>
	The <tt>BioFEM</tt> command accepts one optional argument, which
	is the name of a <i>session</i> file:
      </p>
      <pre>
  ./BioFEM mysession.ses	
      </pre>
      <p>
	where <tt>mysession.ses</tt> has been previously created by
	BioFEM. See <a href="#section_2_3">below</a> for information
	on sessions.
      </p>
      <br /> <br />

      <a name="figure_1" id="figure_1"/>
      <center>
	<a href="figures/biofem-load.gif">
	  <img border="1"
	    src="figures/biofem-load-small.gif" alt="BioFEM
	    Application Window"/></a>
	<br />
	<b>Figure 1: BioFEM Interface Window (Initial
	  State).</b>
      </center>
      <br />

      <a name="section_2_3" id="section_2_3"/>
      <h3>2.3 User Interface Organization</h3>

      <p>
	The BioFEM window contains two panes: the Rendering Pane and
	the Visualization Pane.  The Rendering Pane is
	on the left side of the window. All data interaction and
	visualization is performed in the Rendering Pane. The
	Visualization Pane is on the right side of the window. The
	Visualization Pane guides the user through the application, and
	controls visualization parameters for the Rendering
	window. The panes may be detached from one another by
	clicking on the pane detachment/attachment
	controls&mdash;these are the vertical dashed lines separating
	the panes. When separated, the panes appear as displayed in <a
	href="#figure_2">Figure 2.</a> Detaching the Rendering window
	allows it to be viewed at maximum resolution.  Panes are
	re-attached by clicking on the pane
	detachment/attachment controls.
      </p>
      <br />
      <br />

      <a name="figure_2" id="figure_2"/>
      <center>
	<a href="figures/biofem-panes.gif">
	  <img border="1" src="figures/biofem-panes-small.gif"
	    alt="BioFEM Application detached Windows"/></a><br />
	<b>Figure 2: BioFEM Interface Window (Detached State)</b>
      </center>

      <p>
	The Rendering window contains two top-level menus: File and
	Help.  The File menu, displayed in <a
	href="#figure_3">Figure&nbsp;3</a> contains the following items:
      </p>

      <dl>
	<dt>Load Session...</dt>
	<dd>Loads a previously saved session.</dd>
	<dt>Save Session...</dt>
	<dd>Saves a session, which can be resumed later.</dd>
	<dt>Save Session As...</dt>
	<dd>Saves a session under a new name.</dd>
	<dt>Save Image...</dt>
	<dd>Saves the content of the Rendering pane as an image.</dd>
	<dt>Restore Panes</dt>
	<dd>Restores any closed or hidden Panes</dd>
	<dt>Quit</dt>
	<dd>Quits BioFEM.</dd>
      </dl>

      <p>
	The user is not required to complete all processing steps
	before exiting BioFEM.  A BioFEM session can be stopped and
	resumed using File menu items Save Session... (or Save
	Session As...)  and Load Session.., respectively.  After
	loading a saved session with Load Session..., resume processing and
	visualization by clicking Execute.
      </p>
      <br/><br/>

      <center>
	<a name="figure_3" id="figure_3"/>
	<img src="figures/biofem-file.gif"
	  alt="File Menu"/><br />
	<b>Figure 3: File Menu.</b>
      </center>
      <br/><br/>

      <p>
	The Help menu, shown in <a href="#figure_4">Figure&nbsp;4</a>,
	contains these items:
      </p>

      <dl>
	<dt>Show Tooltips</dt>
	<dd>A checkbox that toggles tooltips on and off.</dd>
	<dt>Help Contents</dt>
	<dd>Provides help on the BioFEM application.</dd>
	<dt>About BioFEM</dt>
	<dd>Provides information about BioFEM.</dd>
      </dl>
      <br/><br/>
      
      <center>
	<a name="figure_4" id="figure_4"/>
	<img border="1" src="figures/biofem-help.gif"
	  alt="Help Menu"/><br />
	<b>Figure 4: Help Menu.</b>
      </center>

      <p>
	A Progress Indicator and an Execute button are found at the
	bottom of the Visualization Pane.  The Execute button starts
	the current processing step.  The Execute button is pressed after
	parameters for the current processing step have been set.
	The Progress Indicator and the text above show information
	about the current state of processing, and suggest the next
	processing step.  It can also indicate when modules are dynamically
	compiling or when they are in an execution state.
      </p>


      <a name="section_3" id="section_3"/>
      <h2>Section 3&ndash;Initial Processing and Visualization</h2>

      
      <p>
	After starting BioFEM, the Visualization pane displays the
	contents of the Data Selection tab.  Verify that the Utah
	Torso Lowres radio button is selected.
      </p>

      <p>
	Click Execute to begin initial processing.  During this step,
	a solution to the forward problem is computed.  This may
	take a few minutes.  As the powerapp progresses, the residual 
        plot in the Data Seletion tab will converge. The Progress 
        Indicator is "busy" during this time.  The Progress Indicator  
        shows "COMPLETE" when processing is finished.
      </p>

      <p>
	Perform these steps to view results in the Rendering window:
      </p>

      <ol>
	<li><p>Click on the tab labeled "Viewer Options".</p></li>

	<li><p>Click on the Views pop-up menu, select menu item
	"Look down -Y axis", then select sub-menu item "Up vector +Z".</p>
	</li>
      </ol>

      <p>
	The Rendering window should look like the Rendering window
	shown in <a href="#figure_5">Figure 5</a>.  The Rendering
	window displays the outer boundary of the torso volume, the set
	of measurement electrodes, the zero-voltage isosurface, and
	streamlines that follow voltage gradients. The electrodes,
	isosurface, and streamlines are color coded to show negative
	voltages blue and positive voltages red.
      </p>

      <a name="figure_5" id="figure_5"/>
      <center>
	<img border="1" src="figures/biofem-vis-all.jpg"
	  alt="Initial Visualization"/><br />
	<b>Figure 5: Initial Visualization.</b>
      </center>
      <br />
      <br />

      <p>
	Interaction with the Rendering window is performed with the
	mouse.  The Rendering window's scene can be translated,
	zoomed, rotated, etc.  <a href="#table_1">Table 1</a> shows
	all mouse actions.  See also <a
	href="../../Guide/usersguide/srug6_3.html">6.3 of User's Guide
	(Mouse Control in the Viewer Window)</a> for more information.
      </p>

      <a name="table_1" id="table_1"/>
      <center>
	<table>
	  <caption><b>Table 1</b>: Rendering Window's Mouse Controls</caption>
	  <thead>
	    <tr>
	      <th></th>
	      <th>Modifier Key</th>
	      <th>Mouse Button</th>
	      <th>Renderer Window Action</th>
	    </tr>
	  </thead>
	  <tbody>
	    <tr>
	      <td rowspan="6"><b>Scene<br/>Controls</b></td>
	      <td rowspan="3">none</td>
	      <td>Left</td>
	      <td>Translate scene</td>
	    </tr>
	    <tr>
	      <td>Middle</td>
	      <td>Rotate scene</td>
	    </tr>
	    <tr>
	      <td>Right</td>
	      <td>Zoom scene</td>
	    </tr>
	    <tr>
	      <td rowspan="3">Control</td>
	      <td>Left</td>
	      <td>Translate scene in Z-direction</td>
	    </tr>
	    <tr>
	      <td>Middle</td>
	      <td>Rotate the camera view about the eye point</td>
	    </tr>
	    <tr>
	      <td>Right</td>
	      <td>Unicam movement</td>
	    </tr>
	    <tr>
	      <td rowspan="3"><b>Rake Widget<br />Controls</b></td>
	      <td rowspan="3">Shift</td>
	      <td>Left</td>
	      <td>Position and orient rake widget</td>
	    </tr>
	    <tr>
	      <td>Middle</td>
	      <td>Toggle widget's modes</td>
	    </tr>
	    <tr>
	      <td>Right</td>
	      <td>Display widget help window</td>
	    </tr>
	  </tbody>
	</table>
      </center>

      <a name="section_4" id="section_4"/>
      <h2>Section 4&ndash;Visualization</h2>


      <a name="section_4_1" id="section_4_1"/>
      <h3>4.1 Viewer Options Tab</h3>

      <p>
	<a href="#figure_6">Figure 6</a> displays the Visualization
	Pane's Viewer Options tab.  The Viewer Options tab provides
	controls for changing the properties of the Rendering Window.
	Hovering the mouse pointer over a control (e.g., Views
	pop-up menu button) displays a tooltip describing a control.
      </p>

      <a name="figure_6" id="figure_6"/>
      <center>
	<img border="1" src="figures/biofem-viewer-options-tab.gif"
	  alt="Viewer Options Tab"/><br />
	<b>Figure 6: Viewer Options Tab</b>
      </center>
      <br />


      <a name="section_4_2" id="section_4_2"/>
      <h3>4.2 Vis Options Tab</h3>

      <p>
	<a href="#figure_7">Figure 7</a> displays the Visualization
	Pane's Vis Options tab.  Controls in the Vis Options tab allow
	selection of visualization type, visualization parameters, and
	colormap.  Visualizations can be viewed individually or
	together. For example, <a href="#figure_5">Figure 5</a> displays
	concurrent visualization of streamlines, zero-voltage
	iso-surface, and electrodes.
      </p>

      <p>
	Visualization types and use of colormaps are demonstrated in
	the following sections.
      </p>

      <a name="figure_7" id="figure_7"/>
      <center>
	<img border="1" src="figures/biofem-vis-options-tab.gif"
	  alt="Vis Options Tab"/><br />
	<b>Figure 7: Vis Options Tab</b>
      </center>
      <br />
      

      <a name="section_4_3" id="section_4_3"/>
      <h3>4.3 IsoSurface Visualization</h3>

      <p>
	An iso-surface is a surface of constant value. <a
	href="#figure_8">Figure 8</a> displays an iso-potential surface
	of value 0.  Produce the visualization in <a href="#figure_8">Figure
	8</a>  by selecting the checkbox labeled "Show
	Isopotential Surface" (from the Vis Options tab), and 
	moving the Electric Potential value slider to 0.
      </p>

      <p>
	The checkbox labeled "Smooth Faces" 
	turns surface smoothing on and off. Smoothing improves
	iso-surface appearance, but hides iso-surface mesh details.
      </p>

      <p>
      The checkbox labeled "Continuous Updates" forces the isosurface
      to change continuously as the slider is moved.  When unchecked,
      the isosurface will only update upon release of the slider.
      </p>
      <br/>
      <br/>
      
      <a name="figure_8" id="figure_8"/>
      <center>
	<img border="1" src="figures/biofem-vis-isosurface.jpg"
	  alt="Isosurface Visualization" />
	<br />
	<b>Figure 8: Isosurface Visualization.</b>
      </center>
      <br />
      <br />

      <a name="section_4_4" id="section_4_4"/>
      <h3>4.4 Streamlines Visualization</h3>
      <p>
	Streamlines are  traces of paths taken by particles along
	voltage gradients. The rake widget is used to establish (or
	seed) initial particle positions within the electric field.
	Particles follow paths that start on one end of the dipole,
	pass through the rake, and end on the other side of the dipole.
 	<a href="#figure_9">Figure 9</a> shows streamlines
	visualization.
      </p>
      
      <p>
	Streamlines visualization is controlled with the rake widget
	and settings in the Vis Options tab.
      </p>

      <p>
	The rake widget's position and orientation determine
	streamline paths.  The mouse is used to translate, rotate, and
	resize the rake widget.  In each case, the Shift key and 
	left mouse button are pressed while dragging a component of
	the rake. Drag the rake's gray bar to translate the rake, drag
	a rake's blue spheres to rotate the rake, and drag the
	rake's green ends to resize the rake.  Streamlines are redrawn
	after the rake is moved.
      </p>

      <p>
	The slide bar labeled Number of Field Lines in the Vis Options 
	tab selects
	the number of seed points along the rake widget.  Seed points
	are evenly spaced along the rake.
      </p>
      
      <p>
	Streamlines are computed using a fast or an adaptive
	algorithm.  Select an algorithm using the radio buttons
	labeled Fast Tracking or Adaptive Tracking.  The fast 
	method walks a mesh
	directly.  The fast method's accuracy is determined by a
	model's accuracy.  The adaptive (slower) method interpolates
	between cells in a model. The adaptive method walks over
	discontinuities, producing a smoother streamline appearance.
      </p>

      <br />
      <br />

      <a name="figure_9" id="figure_9"/>
      <center>
	<img border="1" src="figures/biofem-vis-streamlines.jpg"
	  alt="Streamlines Visualization"/><br />
	<b>Figure 9: Streamlines Visualization.</b>
      </center>
      <br />
      <br />

      <a name="section_4_5" id="section_4_5"/>
      <h3>4.5 Electrodes Visualization</h3>

      <p>
	Visualize electrodes by checking the "Show Electrodes"
	checkbox in the Vis Options tab.  Electrodes are displayed as
	spheres.  Voltage values are computed at each electrode
	position and are color coded.  <a href="#figure_10">Figure
	10</a> shows electrodes visualization.
      </p>
      <br />
      <br />

      <a name="figure_10" id="figure_10"/>
      <center>
	<img border="1" src="figures/biofem-vis-electrodes.jpg"
	  alt="Electrodes Visualization"/><br />
	<b>Figure 10: Electrodes Visualization.</b>
      </center>
      <br />
      <br />

      <a name="section_4_6" id="section_4_6"/>
      <h3>4.6 Colormap Selection</h3>

      <p>
	Voltage values are color coded using a colormap.  Six
	colormaps are available (<a href="#figure_7">Figure 7</a>).  A
	colormap is selected from the Visualization pane's Vis Option
	tab.  <a href="#figure_11">Figure 11</a> displays the
	utahtorso-lowres model colored with the Blue-to-Red colormap
	selected, rather than the default Inverse Rainbow coloring.
      </p>
      <br />
      <br />

      <a name="figure_11" id="figure_11"/>
      <center>
	<img border="1" src="figures/biofem-vis-colormap.jpg"
	  alt="Blue to Red Colormap Visualization"/><br />
	<b>Figure 11: Visualization with the Blue-to-Red
	  colormap selected.</b>
      </center>
      <br />
      <br />

      <a id="appendix_a" name="appendix_a" />
      <h2>Appendix A&mdash;Data Formats and Preparation</h2>

      <p>
	Users may want to use BioFEM to analyze their own data sets.
	Before doing so, the user must convert their data to the form
	used by BioFEM.  This section discusses the preparation and
	conversion of data stored in text-based files to the  form
	used by BioFEM.
      </p>

      <p>
	BioFEM requires these binary inputs:
      </p>
      <ul>
	<li>
	  <p>A discretized volume with associated volume element
	  conductivities.</p>
	</li>
	<li>
	  <p>A dipole source.</p>
	</li>
	<li>
	  <p>The positions of a set of measurement electrodes.</p>
	</li>
      </ul>

      <p>
	Binary inputs are in SCIRun's persistant file object format.
	To create these binary inputs, input data are first prepared
	as text files, then converted to SCIRun's persistant file
	object format using the instructions given below.  The
	converted files can then be used as inputs to BioFEM.
      </p>
      
      <p>
	Conversion of text inputs to SCIRun's persistant file object
	format is performed by command line converter programs and
	SCIRun networks.  The following sections discuss the
	preparation of text file inputs and their conversion to
	SCIRun's persistant file object format.  Reference will be made
	to <a href="../../Guide/usersguide/srug7.html">Chapter 7 of
	the SCIRun User's Guide</a>, which is a complete reference to
	text file formats and command line converter programs.
      </p>

      <h3 id="appendix_a_1">A.1 Preparing Volume Data</h3>

      <p>
	Volume data are stored in four text files: one file contains
	mesh node locations, one file contains mesh connectivity data,
	one file contains conductivity data, and one file contains
	conductivity index data.
      </p>

      <h3 id="appendix_a_1_1">A.1.1 Prepare Mesh Data</h3>

      <p>
	Prepare a node location ("pts") file and a node connectivity
	("quad", "tet", or "hex") file.  Sections <a
	href="../../Guide/usersguide/srug7_4.html#sec:node_loc_fmt">7.4.1</a>
	and <a
	href="../../Guide/usersguide/srug7_4.html#sec:node_conn_fmt">7.4.2</a>
	of the SCIRun User's Guide describe these file formats.  The
	node location and node connectivity files specify the
	discretization of a volume into elements.
      </p>

      <p>
	Create a SCIRun field object using the appropriate converter
	program (converter programs are located in directory
	<tt>SCIRun/bin/StandAlone/convert</tt>).  For example, use
	<tt>TextToTetVolField</tt> to create a field from a "pts" file
	and a "tet" file.
      </p>

      <p>
	The command:
      </p>
      <pre>
  TextToTetVolField torso-mesh.pts torso-mesh.tets torso-mesh.tv.fld
      </pre>

      <p>
	creates the SCIRun field file <tt>torso-mesh.tv.fld</tt>.  File
	<tt>torso-mesh.tv.fld</tt> contains only mesh data.
	Conductivity data are created in steps that follow.  File
	<tt>torso-mesh.tv.fld</tt> is used in a SCIRun network
	discussed <a href="appendix_a_1_3">later</a>.
      </p>

      <h3 id="appendix_a_1_2">A.1.2 Prepare Conductivity Data</h3>

      <p>
	Construct a tensor data file.  The tensor data file's first
	line contains two values: the number of tensors followed by
	the number of values per tensor, which should always be the
	value 9.  Each remaining line contains data for one tensor.
	Tensor data on each line are given in row-wise order.
      </p>

      <p>
	Here are data for 6 tensors:
      </p>

      <pre>
  6 9
  0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 
  0.045 0.000 0.000 0.000 0.045 0.000 0.000 0.000 0.045 
  0.300 0.000 0.000 0.000 0.300 0.000 0.000 0.000 0.300 
  0.200 0.000 0.000 0.000 0.200 0.000 0.000 0.000 0.200 
  0.096 0.000 0.000 0.000 0.096 0.000 0.000 0.000 0.096 
  0.300 0.000 0.000 0.000 0.300 0.000 0.000 0.000 0.300 
  0.680 0.000 0.000 0.000 0.680 0.000 0.000 0.000 0.680 
  0.045 0.000 0.000 0.000 0.045 0.000 0.000 0.000 0.045 
  0.680 0.000 0.000 0.000 0.680 0.000 0.000 0.000 0.680 
  0.0129 0.000 0.000 0.000 0.0129 0.000 0.000 0.000 0.0129
      </pre>

      <p>
	Each tensor is implicitly numbered (indexed) starting with 0.
      </p>

      <p>
	Prepare a tensor index file.  A tensor index file assigns
	tensors in a tensor data file to volume elements defined in a
	node connectivity file.  The first line of the tensor index
	file contains the number of tensor index values, which must
	equal the number of volume elements.  Each remaining line
	contains the index of a tensor in the tensor data file.  The
	first index value assigns a tensor to the first volume
	element, the second index value assigns a tensor to the second
	volume element, and so on.
      </p>

      <p>
	Here is the first part of a tensor index file:
      </p>

      <pre>
  51419
  3.000000
  4.000000
  3.000000
  3.000000
  3.000000
  3.000000
  4.000000
  4.000000
  3.000000
  3.000000
  .
  .
  .	
      </pre>

      <p>
	Above, volume elements 0, 2&ndash;5, 8, and 9 are assigned
	the fourth tensor in the tensor data file.  Volume elements 1,
	6, and 7 are assigned the fifth tensor.
      </p>

      <p>
	Create SCIRun data objects containing conductivity data and
	indicies using converter programs <tt>TextToDenseMatrix</tt>
	and <tt>TextToColumnMatrix</tt>.
      </p>

      <p>
	Here are the commands:
      </p>

      <pre>
  TextToDenseMatrix torso-conductivity-table.txt torso-conductivity-table.dmat
  TextToColumnMatrix torso-conductivity-indices.txt torso-conductivity-indicies.cmat
      </pre>

      <p>
	These commands create files
	<tt>torso-conductivity-table.dmat</tt> and
	<tt>torso-conductivity-indicies.cmat</tt> respectively.  Files
	<tt>torso-conductivity-table.dmat</tt> and
	<tt>torso-conductivity-indicies.cmat</tt> are used in a SCIRun
	network <a href="appendix_a_1_3">below</a>.
      </p>
      
      <h3 id="appendix_a_1_3">A.1.3 Generating the Final Field</h3>

      <p>
	Execute <a type="text/plain"
	href="nets/build-tet-vol-of-tensors.net">the SCIRun
	network</a> displayed in Figure A1.  This network combines
	files <tt>torso-mesh.tv.fld</tt>,
	<tt>torso-conductivity-table.dmat</tt>, and
	<tt>torso-conductivity-indicies.cmat</tt>, into a SCIRun
	volume field object that can be used in BioFEM.
      </p>

      <a name="figure_a1" id="figure_a1"/>
      <center>
	<img border="1" src="figures/volume_fld_net.gif" alt="Network that
	creates a complete SCIRun volume field"/>
	<br/>
	<b>Figure A1: Network that creates a complete SCIRun volume field</b>
      </center>


      <h3 id="appendix_a2">A.2 Preparing a Dipole Field</h3>

      <p>
	Prepare a "pts" file specifying the location of a dipole
	source.  The file will contain one location.
      </p>

      <p>
	For example:
      </p>

      <pre>
  1
  59.699700 -40.050700 331.581000
      </pre>

      <p>
	Create a partial (position information only) SCIRun dipole
	field using <tt>TextToPointCloudField</tt>.
      </p>

      <p>
	For example:
      </p>

      <pre>
  TextToPointCloudField dipole.pts dipole-pts.fld
      </pre>

      <p>
	File <tt>dipole-pts.fld</tt> contains position information only.
	File <tt>dipole-pts.fld</tt> will be used in a SCIRun network
	described later.
      </p>

      <p>
	Prepare a file specifying the dipole's orientation and
	magnitude.  The file will contain the components of a vector
	representing the dipole's orientation and magnitude.
      </p>

      <p>
	For example:
      </p>

      <pre>
  1 3
  -387.386000 -380.386000 666.388000 
      </pre>

      <p>
	Create a SCIRun matrix file containing the dipole's orientation and
	magnitude using converter program <tt>TextToDenseMatrix</tt>:
      </p>

      <pre>
  TextToDenseMatrix dipole-mat.txt dipole.mat
      </pre>

      <p>
	Create a complete SCIRun dipole field from
	files <tt>dipole-pts.fld</tt> and <tt>dipole.mat</tt> using the
	<a type="text/plain"
	href="nets/build-dipole-fld.net">network</a> displayed in
	Figure A2.
      </p>

      <a name="figure_a2" id="figure_a2"/>
      <center>
	<img border="1" src="figures/dipole-fld-net.gif" alt="Network that
	creates a complete SCIRun dipole field"/>
	<br/>
	<b>Figure A2: Network that creates a complete SCIRun dipole field</b>
      </center>
      

      <h3 id="appendix_a_3">A.3 Prepare Measurement Electrodes</h3>

      <p>
	Prepare a "pts" file.  Each "pts" file line specifies the
	coordinates of one electrode.
      </p>

      <p>
	Create a SCIRun point cloud field using converter
	<tt>TextToPointClouldField</tt>.
      </p>

      <p>
	The command:
      </p>

      <pre>
  TextToPointCloudField electrodes.pts electrodes.pc.fld
      </pre>

      <p>
	creates the SCIRun field <tt>electrodes.pc.fld</tt> from the
	file <tt>electrodes.pts</tt>.
      </p>

      <center>
	<img src="images/footer.gif" alt="BioFEM bottom banner"/><br />
      </center>
    </div>
  </body>
</html>
